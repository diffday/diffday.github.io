<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>数据中台与技术漫谈 | Diffday</title><meta name="keywords" content="大数据"><meta name="author" content="DiffDay"><meta name="copyright" content="DiffDay"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#f7f9fe"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="数据中台与技术漫谈"><meta name="application-name" content="数据中台与技术漫谈"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#f7f9fe"><meta property="og:type" content="article"><meta property="og:title" content="数据中台与技术漫谈"><meta property="og:url" content="https://blog.diffday.com/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0%E4%B8%8E%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88.html"><meta property="og:site_name" content="Diffday"><meta property="og:description" content="数据中台 数据中台并不产生数据，而是将组织在业务中产生的全域数据，汇进数据中台建立一套标准，形成数据资产后再进行服务化，业务化的过程。 目标 目标在于提升运营效率，决策效率，数据精准。对外支撑各种场景应用。  在实施上把数据加工，存储，分析，建模等与数据相关的所有事情都可轻松的解决 从管理上把一切"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="http://cdn.diffday.com/picgo/20241023162552.png"><meta property="article:author" content="DiffDay"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="http://cdn.diffday.com/picgo/20241023162552.png"><meta name="description" content="数据中台 数据中台并不产生数据，而是将组织在业务中产生的全域数据，汇进数据中台建立一套标准，形成数据资产后再进行服务化，业务化的过程。 目标 目标在于提升运营效率，决策效率，数据精准。对外支撑各种场景应用。  在实施上把数据加工，存储，分析，建模等与数据相关的所有事情都可轻松的解决 从管理上把一切"><link rel="shortcut icon" href="https://cdn.diffday.com/picgo/diff32.ico"><link rel="canonical" href="https://blog.diffday.com/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0%E4%B8%8E%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88"><link rel="preconnect" href="//npm.elemecdn.com"/><link rel="preconnect" href="//npm.onmicrosoft.cn"/><link rel="preconnect" href="//www.google-analytics.com" crossorigin=""/><link rel="preconnect" href="//hm.baidu.com"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="UaMvLIOYuNWHgVq42dlN49RoniU73U6SoqoRnEcit9E"/><meta name="baidu-site-verification" content="code-DN25SBuR8T"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = "https://hm.baidu.com/hm.js?b5c9889dd454fff053fb5b93fc1b2ac7";
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script><script async="async" src="https://www.googletagmanager.com/gtag/js?id=G-X0MW6B53JB"></script><script>window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'G-X0MW6B53JB');
</script><script>const GLOBAL_CONFIG = {
  linkPageTop: {"enable":true,"title":"同博主们无限进步","addFriendPlaceholder":"昵称（请勿包含博客等字样）：\n网站地址（要求博客地址，请勿提交个人主页）：\n头像图片url（请提供尽可能清晰的图片，我会上传到我自己的图床）：\n描述：\n站点截图（可选）：\n"},
  peoplecanvas: undefined,
  postHeadAiDescription: undefined,
  diytitle: {"enable":true,"leaveTitle":"一次时空相逢，祝好！","backTitle":"欢迎回来！"},
  LA51: {"enable":true,"ck":"3G4PP4R5LAAt6DBv","LingQueMonitorID":"3GA1sASrkc8hJd7c"},
  greetingBox: {"enable":true,"default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 为下午蓄力充电","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: '',
  commentBarrageConfig:undefined,
  root: '/',
  preloader: undefined,
  friends_vue_info: undefined,
  navMusic: false,
  mainTone: {"mode":"both","api":"https://img2color-go.vercel.app/api?img=","cover_change":true},
  authorStatus: undefined,
  algolia: undefined,
  localSearch: {"path":"/search.json","preload":true,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    simplehomepage: true,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: DiffDay","link":"链接: ","source":"来源: Diffday","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: true,
  islazyload: true,
  isAnchor: true,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'Diffday',
  title: '数据中台与技术漫谈',
  postAI: '',
  pageFillDescription: '数据中台, 目标, 价值锚定, 工作范畴, 能力建设, 数据治理怎么强调都不为过, 算法建模管理, 团队划分, 数字化转型忐忑艰苦, 指导思想, 总结与例说, 过去的债务, 古早技术概念介绍, 数仓的星型和雪花模型（多表组合模型）, 宽表模型和多表组合模型, 基数估计, OLTP vs OLAP, OLAP 脑图, 并发差异, Hadoop的调度演进, 大数据架构, Lambda 架构, Kappa 架构, 湖仓一体化, 实时数仓, 三大当红国际派, 多记一嘴 Hudi, Doris, Kudu, 总结, 湖仓对比, 融合流派（Data Lakehouse）, 数据复杂性与管理挑战, 体系融合, 总结 vs 预测, OLAP 查询引擎, 古早实时数据探索系统的问题, 新质生产力对比, 细说说一众引擎, Presto, Impala, ClickHouse, Greenplum, 优势, 劣势, Druid, 不适合的场景, OLAP 的实现模式, 能力对比, 性能特性比较, 简单查询, 复杂查询, ES 出列单看, 多记一嘴 Druid, 时序数据库特性, Segment设计, 行数据结构剖析, 位图索引再举例, 设计讨论, Druid vs Impala, Druid vs Kylin, 新的Topic与期待, 全频谱可平衡支持, 数据网格, 数据安全, IOT 时代的不同, DW Automation, 几朵乌云, Other, 参考数据中台数据中台并不产生数据而是将组织在业务中产生的全域数据汇进数据中台建立一套标准形成数据资产后再进行服务化业务化的过程目标目标在于提升运营效率决策效率数据精准对外支撑各种场景应用在实施上把数据加工存储分析建模等与数据相关的所有事情都可轻松的解决从管理上把一切的数据口径项目工程等都管理起来面对客户使客户一站式在此平台上获取到任何想要的数据有足够的数据应用能力价值锚定梳理业务场景搞清楚中台如何对业务产生价值回归到业务本质如何提升商业能力工作范畴工作内容涵盖数据标准和指标建设数据采集数据集成数据治理数据应用数据资产管理大数据仓库等技术应用能力建设复用性资源整合能力沉淀数据深度整合沉淀为公共数据服务这些能力在构建数据中台之初就是必须去直面的问题能力沉淀数据接入能力计算能力存储能力业务支撑能力展现能力数据域的建设分为内容建设工具建设过程数据工具调度工具元数据工具指标字典库表字典数据质量内容价值探索工具体系化建设是数据平台的基石内容透过工具提取出价值指标字典解决公司指标管理口径管理的问题每个工具产品解决特定领域的问题数据治理怎么强调都不为过和业务独立开的数据治理少有成功的治理需要跟业务场景紧密结合大的数据标准要有数据资产目录通过数据资产目录将共有的维度共性的业务模型提炼出来建立统一的企业级数据指标体系解决数据来源多元化和标准不统一的问题规范有序的完成数据采集建模分析集成应用和资产管理应用服务使用分析服务提升建议趋势分析个性服务推荐影响分析可视化报表大屏服务管理服务创建管理资产管理资产门户标签管理价值评估标准管理资产建设数据交换数据开发算法建模可视化开发任务发布管理任务调度管理任务运维监控基础设施层各类数据源算法建模管理分类逻辑回归算法算法算法算法随机森林算法回归线性回归模型朴素贝叶斯模型回归模型回归模型聚类均值算法高斯混合模型算法幂迭代聚类模型隐含狄利克雷分布关联降维奇异值分析主成分分析时间序列模型模型模型模型模型识别产业舆情矩阵模型产品价格弹性模型产业聚集度模型团伙分析模型重点人员行为模型商标相似度检测模型预测企业成长性模型重要商品价格预测模型钢铁企业融资模型环境预警模型销售订单预测模型优化资本热度模型景气指数模型克强指数模型扶贫资金分配优化模型团队划分业务专家团队数据治理团队数据工程团队平台数据分析团队智能算法团队数据中台和数据平台有一个潜台词的区别就是最终会有数据服务化的目标提高数据共享能力治理的好避免数据的重复计算一般一上来就喊中台化的基本入不敷出不是人员投入问题就是实施方向以及定位到底是什么不明确有的企业用演进的办法来做实施是个非常不错的选择失败的数据中台常碰到如下问题人的争斗有几方人势力都想驱动这个平台想法太多能力问题做中台难度和普通产品比有量级的差异能力不足真搬不动这块石头还砸自己的脚头疼医头原本一条线到头的建设实际上变成头痛医头的复杂网建设高投低产资源问题产研几十位运营几十数据人员几十审核人员可能上百算上流动前后大概可能有好几百人如果一开始给了老板很高的预期希望花一年的时间几十人就能完成中台的建设到头来不断降低预期投入产出比不断透支可想最终的结果数字化转型忐忑艰苦指导思想被动响应转主动建设修炼内功降本增效工具建设提升自身效率标准化组件化内部运营工具沉淀优化内容建设围绕业务场景化做敏捷探索总结与例说综合言之支持业务商业模式不停快速尝试下的数据场景化需求还要进行自身内容与工具化建设拆解历史包袱系统化业务在线化业务信息化数据整合化业务智能化也有企业信息化能一部到位毕竟这样的很少更多是原来资源的整合升级举例定制化的数据产品改成了可配置化持续做减法表从近万张缩减到几千张成千的指标一样做缩减通过该数据做数据作战地图数据产品的方式来做数据模型的阶段性布局和设计定优先策略过去的债务在过去企业构建基础设施的过程中逐渐形成了各种烟囱式的数据设施也带来了数据孤岛问题还有一点可怕的事是任务和中间过程大量膨胀不仅是存储问题更大的挑战是无数的任务其实不断地做重复性的工作不断消耗整个数据集群的资源还存在数据口径不一致的问题数据来源又可能有分歧如这个部门说自己是从中看到的另一个部门说是从数仓里看到的这就不能帮助企业做出高效的决策过去上了到电子化时就有一个企业流程再造的说法就是说你上系统要先梳理自己的业务流程梳理不好系统上不去也没法提升管理能力现在和那个阶段有一点味道相像一样要先将企业的指标数字化运营的思路理清楚如果讲不清业务目标过程目标结果目标那就不知道拿什么追踪拿什么来做数字化的管理各部门各组织都非常有欲望生产自己的数据指标会形成几百倍的放大不同部门指标不统一指标过时都属于管理问题古早技术概念介绍数仓的星型和雪花模型多表组合模型区别就是对维度表的拆分雪花模型维度表设计更加规范一般符合第三范式而星型一般采用降维操作用冗余避免模型过于复杂提高易用性和分析效率在数据仓库中多用星型模型构建宽表维度整合减少多表关联方便性能高在数据采集中要注意完整性校验针对缺失字段的数据建议直接丢掉也可以用同列前后一个数据来填补还要注意合法性校验异常值全部替换为一个特殊值特殊值这要根据具体的业务场景而定宽表模型和多表组合模型宽表型组合模型应用计算模型宽表模型能提供比多表模型更好的查询性能不足的是支持的操作类型比较有限如对等复杂操作支持较弱或不支持多表组合模型一般均基于架构相较其它类型的和通常不具有性能优势实时性较一般但其支持的数据量大支持类型多样这样通用系统往往比专用系统更难实现和进行优化基于明细数据的多维模型雪花模型能支持业务灵活用数问题但性能问题令人头疼开发简单但效率完全依靠数据库本身当数据量到一定程度后很难保证性能所以又出现了大量为解决性能而开发的报表物理表宽表能解决效率方面很多问题但相对于会带来管理运维成本的增加基数估计一直是大数据领域的重要问题之一一批数据中不重复的元素有多少个以为例对访问量巨大的系统来说统计出亿和亿零其实没太多的区别因此在这种业务场景下为了节省成本可只计算出一个大概的值没必要算出精准的值大家常规用字典的数据结构遍历字典后得到的整体计数就是这批数据的基数了这种算法虽然精准度很高但使用的空间复杂度却很高故提出一些近似方法估算数据集合的基数如与不同系统强调数据库内存效率强调内存各种指标的命中率强调并发操作强调事务性系统则强调数据分析强调磁盘强调分区它是一种让用户可以用不同视角方便快捷分析数据的计算方法主流可分为三类多维典型代表是它们一般会根据用户定义的数据维度度量也可以叫做指标在数据写入时生成预聚合数据查的是预聚合数据而不是原始明细数据不支持明确数据的查询仅适合这种查询场景相对固定且对查询性能要求非常高的场景其优缺点都来自于其数据预处理环节预聚合处理需预先定义维度会限制后期数据查询的灵活性如果查询工作涉及新的指标需重新增加预处理流程关系型典型代表是数据写入时并未应用像那样的预聚合技术收到请求时会生成执行计划扫描数据执行关系型算子在原始数据上做过滤聚合关联分组排序整个过程都是即时计算拼的都是资源和算力的大小不需要进行预处理因此查询灵活可扩展性好这类引擎使用架构与相似的大型并行处理架构可通过扩大并发来增加计算资源可高效处理大量数据有人说和属于模型其实并不算一种单独的模型它只是生成执行计划的一种方式执行查询慢的痛点推动了内存迭代和计算模型的发展减少资源消耗充分利用资源但事情往往是两面的中间结果不落盘正常情况是利好异常情况如出现节点宕机需要重新计算中间结果拖慢任务完成时间另扩展性没有架构好随着系统节点增多到一定规模源于木桶效应性能无法线性提升且规模越大出现宕机坏盘等异常情况就会愈频繁会导致重试概率提升所以比较适合执行时间不会太久的业务场景如数小时因为时间月越久故障概率越大混合将聚合信息存储在服务器上详细记录保留在关系表中因此不会保留重复副本平衡了磁盘空间需求劣势正是同时支持和本身体系结构非常复杂或者换种说法其允许模型升级者决定哪些数据存储在中哪些数据存储在中把数据划分成传统关系型存储细节数据和专有存储聚合数据脑图架构架构通用型通用型并发差异在场景一般认为达到就算高并发而不是以上才算毕竟数据分析场景数据海量计算复杂达到已经非常不易如在级别单集群达到已经很困难更适合企业内部报表使用而不是广告主平台报表的执行模型决定了它会尽全力来执行一个而不是同时执行很多的调度演进在中计算框架既负责集群资源调度还负责程序运行资源调度和计算的高度绑定耦合到了改成了的架构这样就保证集群既能跑计算任务还能跑任何支持资源调度的计算任务如等大数据架构架构同一套指标需开发两套代码进行在线和离线分析维护复杂数据应用查询指标可能需同时查询离线数据和在线数据开发复杂两套引擎流批运维复杂数据更新要整张表或分区成本高随着在线分析业务越越多架构的弊端越发明显增加一个指标要在线离线分别开发离线指标还可能和在线指标对不齐部署复杂组件繁多真是一个痛苦的时代架构使用同套引擎同时处理在线和离线数据数据存储在消息队列上也有其局限消息队列的容量特性使得历史数据可能无法回溯数据可能乱序可能对部分时序要求严格的应用造成数据错误流计算引擎批处理能力较弱处理大数据量性能较弱从消息队列取数没有自然需要开发适配开发复杂湖仓一体化实时数仓三大当红国际派基于和架构的缺陷凸显了在大数据领域实时数仓的建设和维护非常重要孵化的孵化的孵化的都在尝试解决此问题三者均为的数据存储中间层为了解决的增量问题诞生于旨在解决文件列表等云存储规模问题当时是上存储大型分区数据集时出现的性能可扩展性和可管理性挑战定位高性能分析与可靠的数据管理定位流批一体的数据处理三种场景的不同造成三者设计上的差别在数据方面性能不及查询性能不如但与整合好工作场景多从字节和亚马逊的实践上看当前上下游生态的开放性和成熟度上对全局索引的支持对某些存储逻辑的定制化开发接口暂胜一筹如有强大的数据摄取实用程序允许你从各种来源增来摄取上游更改三者都支持数据可变更并发控制也都支持的不错其中相比较另两个还支持能更好应对流式场景减少写放大的发生在元数据变更上很有优势其设计能进行可任意地改变列的位置类型还提供能帮助更好地管理数据另两个引擎只能与结合利用了的同样直接使用或的在上比较弱只支持在最后新增列在多引擎支持方面原生设计就为了支持多引擎分层设计很好想增加一个新的引擎时就很简单和绑定骄较深移植困难支持多引擎只是支持别的引擎的话增加代码会比较多需从底层往上垒代码对后端存储的支持对后端存储之要求简单的三点不管是分布式存储还是对象存储大多数都支持相比它的是比较严格的要求有些对象存储可能满足不了并未对存储有什么具体要求只要你实现一个就可以跑对于数据湖大家可能进行数据探索和开发如果你的存储格式在并发读并发写包括元数据变更上不友好在任务编排上就会出现很大的局限性另外最好对多种计算引擎都亲和支持以方便拥抱技术调整还有一点比较重要的是部署和存储选择灵活云托管对象存储也支持多记一嘴和间的关系是相互依赖的作为数据管理工具可将数据以表的形式存储到中而可通过表的方式对表进行查询和分析可理解为赋能了表增量更新和删除的能力且相较于几种原始表存储格式有更高效的索引实现它本质上是在大数据存储上的一个数据集使得用户能在兼容的存储上存储大量数据其实也可以不依赖可以用操作系统的文件系统存储但为了分析性能和数据可靠性一般都搭配对上可暴露成一个普通的表或表通过或命令行可以获取到增量修改的信息且保管了修改历史可做时间旅行或回退以两种不同的存储格式读优化的列存格式缺省值是写优化的行存格式缺省值是是一个大规模并行处理框架架构的分析型数据库孵化于百度的是根据论文和项目改写的一个大数据分析引擎架构整合列式存储三种技术通过实现预聚合实现连接处理列存储更好服务数据分析兼容标准且完全兼容协议运维部署难度不高只有负责管理元数据解析生成和调度查询计划存储数据及执行生成的查询计划两种组件简单易用多副本的机制减少数据网络拷贝将数据进行分区分桶后分发散列到各个节点实现分布式计算亚秒级获得查询结果有效支持实时数据分析支持批量数据和流式数据支持数据更新支持聚合表和物化视图特点是采用了预聚合技术向量化执行引擎架构且在数据写入时建立多级索引将任务并行分散到多个服务器和节点上结合单节点的多核并行处理能力在每个节点计算完成后将各部分结果汇总在一起得到最终结果再加上列式存储是一个高效的查询引擎如果你数据量比较小可在里完成一站式分析但当数据量变大时和分析都在里进行时会相互影响性能这时势必要将任务分摊出去外挂湖需要单独部署集群则不需要还有个关键区别是还试图充当的工作负载和数据存储且虽然支持更新但不支持增量拉取在增量自动处理方面要方便的多于分布式文件系统抽象和完全不同它自己的一组存储服务器通过相互通信则与兼容的文件系统可一起使用不同于或是作为数据湖的存储方案设计初衷是作为和的折中同时具有随机读写和批量分析的特性但相较于前两者不支持云存储版本回滚和增量处理总结新技术的出现使得数仓支持数据等特性使得数仓的时效性从小时级提升到分钟级支持部分更新兼具流计算的实时性和批计算的吞吐性支持近实时场景但也要认识到数据湖模式无法支撑更高的秒级实时性也无法直接对外提供数据服务需要搭建其他的数据服务组件湖仓对比对比维度数据湖数据仓库方法论事后建模事前建模存储类型结构化半结构化非结构化文件结构化半结构化表计算引擎向所有引擎开放各引擎有限优化向特定引擎开放易获得高度优化成本易启动难运维管理难启动易运维管理数据治理质量低难管理使用质量高易管理使用随着数据量的增长运维管理会越来越困难所以有很多数据湖最终有可能变成数据沼泽比如大家也不知道这个数据属于谁谁被谁来用能不能删掉该怎么治理这是数据湖面临的一个问题大多数数据仓库建立之初要有一个有关整体数据建模的顶层设计所以数据仓库的启动成本很高但这种很好的顶层设计会使数据仓库日后扩展时的运维和管理成本变得更低长线成本优势变得非常明显但数仓在面对这种非结构化数据存在很大挑战它几乎不支持音视图类型的数据而数据湖可存储所有类型更灵活更有优势融合流派数据复杂性与管理挑战的受访者报告他们有到个或更多的数据源显示了数据整合和管理的复杂性湖仓架构通过减少数据移动和数据副本提高了查询速度并降低了成本大型企业预计能节省成本以上的受访者也觉得他们能节省以上的分析成本体系融合这两个体系可以说是硬币的两面很多厂商开始考虑怎么在数据湖上应用更多数据仓库技术反过来数据仓库厂商也希望用数据湖技术使自己更开放这两个技术在相互学习和融合也就造出一个新名词湖仓一体一种将数据湖的灵活性和数据仓库的结构化查询能力相结合的架构支持各种数据类型的高效存储和分析有两个流派双方都在发展中仓外挂湖左边一个数据仓库右边一个数据湖中间以高速网络相连形成联动这种流派的代表是的另一个流派是数据湖向数据仓库演进湖上建仓整体架构师在数据湖上搭建数据仓库阿里云的是代表总结预测大数据平台的发展在很长一段时间几乎都是以分析为轴主流接口是侧重结构化的数据和二维关系表达的运算模式以历史数据为主在之上做统计和分析非结构化的数据处理过去一直是瓶颈但年前的深度学习技术突破了这一瓶颈在过去年中算法类负载在数据中心里从一个很低的比例增长到正式成为数据平台的一等公民说数据分析和侧重于历史数据总结算法和具备越来越好的面向未来做预测的能力该说法有合理性查询引擎古早实时数据探索系统的问题第一代的实时数据探索通常是的方案存在下述问题流量高峰期处理延迟纬度交叉分析不灵活消耗资源大碰到系统故障时重算慢在大内存情况下很容易崩溃哪天一个硬件故障一天的数据可能要重算算一天需要十几个小时新质生产力对比在传统的数据仓库架构中是在数据仓库之外在数据仓库之内的体系引入数据仓库领域后大大提升了数据处理的能力集群的扩展能力数据存储的稳定性但是牺牲了数据的查询能力都是为了解决查询而设计的但这些基于设计的引擎只是加速了查询速度未能达到令人惊艳的速度和在速度方面更胜一筹在支持的计算上更为通用更适合场景然而这些通用系统往往比专用系统更难做性能优化所以不太适合做的在线服务更适合做公司内部的查询服务和加速查询的服务是一套的数据库但作为非独立分析处理能力并不理想性能在不同场景下表现参差不齐当时间回到年市场上找开源工具就像在非洲大草原上找树一样寥寥无几可能只有或的最佳存储引擎为预计算查询效率出色但预计算带来的维度爆炸会给存储带来一定压力有个维度就会有种组合所以最好控制好维度的数量也有缺点对支持弱组件众多需大量安装维护工作侵入的依赖精确去重较慢细说说一众引擎适合秒级查询专注预计算最初由开发并开源贡献和实时数据更新和高吞吐写入但多表查询支持性能不好并发较低有较好的生态但作为老将应对超大规模数据已显颓势是它的设计和编写完全是为了解决像这样规模的商业数据仓库的交互式分析和处理速度问题它不是一个数据库是一个运行在多台服务器上的分布式系统命令行把提交给解析分发处理队列到将多个数据源进行合并跨越整个组织进行分析主要用来处理响应时间小于秒到几分钟的场景并没有使用而是通过一个定制的查询和执行引擎来完成所有的查询处理在内存中所以性能较快很多但多张大表关联操作时易引起内存溢出错误实际体验结果查询延迟一般因为它是从明细层开始查询没有任何预聚合是受到启发主导开发的的升级品不同于的原始过程提供访问文件系统中数据的最快方法但不能读取自定义二进制文件仅限于文本文件使用的元数据完全在内存中进行计算是平台当时首选的级大数据实时查询分析引擎通常搭配存储引擎一起提供服务最大优势是点查比较快且支持数据的和由俄罗斯公司开发专为在线数据分析而设计是俄罗斯搜索引擎公司日处理记录数十亿级其从场景需求出发定制一套全新高效列式存储引擎实现了数据有序存储主键索引稀疏索引数据数据主备复制等丰富功能用实现具备向量化执行剪枝等优化能力具备强劲的查询性能不依赖体系比较擅长的地方是对大数据量单表进行聚合查询比较适合内部报表型应用可提供级别的响应速度今日头条内部用做用户行为分析内部一共几千个节点单集群最大节点总数据量几十日增原始数据左右腾讯也用做游戏数据分析并建立一整套监控运维体系携程内部从年月开始试用现年每天数据增量十多亿近百万次查询请求快手内部也在使用存储总量大约每天新增查询小于秒作为目前所有开源计算框架中计算速度最快的它在做多列的表同时行数很多的表的查询时性能是很让人兴奋的但是在做多表的时它的性能是不如单宽表查询的性能测试结果表明在单表查询方面表现出很大的性能优势但是在多表查询中性能却比较差不如的效果好单表查询性能对比包括确实要高很多但没有高速低延迟的更新和删除方法行级别的更新删除方法一般都是异步进行在基于开发采用架构的关系型分布式数据库其支持特性配置选项和最终用户功能在大部分情况下和非常相似相比较可以使用追加优化的存储格式来批量转载和读取数据且能提供表上的性能优势追加优化的存储为数据保护压缩和行列方向提提供了校验和行式和列式追加优化的表都可以被压缩的网络层允许在不同的实例之间通讯让系统表现为一个逻辑数据库也包括为针对商业智能负载优化而设计的特性提取下和的主要区别在基于查询规划器的常规查询规划器之外可以利用进行查询规划可以使用追加优化的存储可选用列式存储只能和追加优化表一起使用在所有使用列式存储的追加优化表上都提供了压缩优势有完善的生态系统可以与很多企业级产品集成譬如等也可以很多种开源软件集成譬如等从应用编程接口上讲它支持和完善的标准支持使得系统开发维护和管理都大为方便支持分布式事务支持保证数据的强一致性作为关系型数据库产品它的特点主要就是查询速度快数据装载速度快批量处理快而且性能可以随着硬件的添加呈线性增加拥有非常良好的可扩展性因此它主要适用于面向分析的应用比如构建企业级或者数据集市等劣势无法对实时数据进行增量聚合计算难支持实时数据分析数据扩容时需进行数据重分布需人工操作且工作量大影响线上服务前端采用作为自由拖拽实现灵活查询和效率之间的一个相互平衡和制约查询效率不会太高业务更关心的是能出数而不是效率本身但在这个年代选择多了已经不流行了但在大数据体系成熟之前在年之前还是有很多公司引入其做基础数据仓库不乏银行金融机构淘宝支付宝等由一家广告数据分析平台公司开发并于年开源创建的最初意图是为了解决查询延迟问题毕竟使用来实现交互式实时查询分析很难在这方面提供了以交互式访问数据的能力并权衡了查询的灵活性而采取了特殊的存储格式它的核心架构吸收结合了数仓时序数据库及检索系统的优势其功能介于和之间几乎实现了的全部功能且从吸收了一些有趣的数据格式在二者基础上增加了一些新特性如为局部嵌套数据结构提供列式存储格式实时摄取收录事件和查询事件创建后毫秒秒内查到高容错的分布式体系架构等每天能处理数十亿事件和级数据其应用最广的是广告分析点击流分析广告监控及网络监控等最适合应用于面向事件类型的数据数据插入频率较高但较少更新数据多数查询场景为聚合查询和分组查询数据具有时间属性对时间做了优化设计需要对高基维度数据列用户等进行快速计数和排序需要从对象存储中加载数据无论何种查询历史节点都会先将相关数据文件从磁盘加载到内存然后再提供查询服务历史节点的查询效率受内存空间影响很大内存越大需从磁盘加载数据的次数就越少查询速度就越快目前在实际应用中遇到的最大问题是缺少支持精确的基数计算的数据结构的架构组件比较复杂协调器历史节点实时节点部署和运维成本较高对的支持不够全面某些复杂查询可能要自定义实现有三个外部依赖存储各种存储的载体本地磁盘均可管理当前的状态如哪些由移到了不适合的场景如果你需要对现有数据进行低延迟的更新操作就不太合适用了它支持流式插入流数据摄入后会以形式保存在内存中定期将序列化成文件持久化到可靠存储中如但不支持流式更新更新通过后台批处理作业完成批数据摄入则会直接生成存储供服务加载使用其查询并发有限不适合查询不支持使得只适合处理星型模型的数据实时数据要能容忍丢失数据的实现模式作为一个数据库需要支持类似上卷切块切片下钻等操作但不适合明细查询根据某主键定位唯一数据的任务常见的数据库实现方式有以下几种数据检索引擎如可存储结构化非结构化数据同时具备明细查询和聚合查询能力但其索引类型并不是针对聚合分析设计的所以聚合查询方面开销较大其次不但要保存所有原始数据还需要生成较多索引所以存储空间开销会更大数据写入效率较会差一些相比较只能处理结构化数据预定义由于进行预聚合所以抛弃了原始数据导致其缺少原始明细查询能力若关闭预聚合又会丧失的优势预计算存储实现如缺点是需在预处理中处理预设的聚合逻辑故损失了查询灵活性且面临数据过于膨胀的情况引擎如能力对比离线查询实时查询丰富的百亿数据集聚合亚秒级响应精准去重表关联弱相较于没有模型管理和管理能力无法提供实时查询相较优势在于聚合计算优势在于查询明细性能特性比较简单查询在简单查询场景命中索引或物化视图预聚合数据这样的查询通常出现在在线数据服务的企业应用并发查询量大对响应时间要求一般是级别最合适的是这些的的在亚秒级别响应的只有在落在分钟小时级其它在秒级简单查询吞吐能力毫秒分钟小时几十几千高高时延高低时延低低时延低高时延复杂查询复杂查询场景指复杂聚合查询大批量数据在场景中往往用户不能预先知道要查什么更多是探索式的复杂查询吞吐能力毫秒分钟小时几十几千高高时延高低时延低低时延低高时延出列单看都是单轮的中间结果结果存储在内存中通过网络直接交换而不是像典型的多轮每次要先落盘用做引擎有几项优势查询模式简单的场景高低延迟过滤条件多底层依赖文件格式可把理解为一种行列混存的模式在查询时通过跳表加快数据查询但单轮的模式单节点汇聚若数据量较大数据量较大或进行扫描聚合类查询时由于是单节点执行可能会非常慢集群自动化管理能力非常强集群索引管理和查看非常丰富多记一嘴很多数据仓库产品都是以批处理为基础这导致记录指标时的时间与进行分析时的时间间出现延迟指标是衡量事物发展程度的单位和方法通常需要经过加和平均等聚合统计才能得到如页面停留时长用户获取成本维度是事务现象的某种特征如性别地区时间版本操作系统都是维度只会预计算最细粒度的维度和时间结果减少维度爆炸问题是一种比较平衡的方式之所以能在家族中占一席之地除了依赖架构外还运用了四点重要的技术预聚合减少数据存储于避免查询时不必要的计算列式存储字典编码有效提升数据压缩率位图索引让很多查询转化成计算机层面的位计算提升效率存储层是的核心组件用于存储和管理数据其用列式存储格式来优化查询性能和压缩数据大小存储层由多个数据分片组成每个分片都包含了特定时间范围内的数据数据分片可水平扩展和复制以实现高可用性和高吞吐量使用过程中维度不要太多维度数据导入将十分耗时磁盘适用固态盘这样你的查询速度才稳定的快时序数据库特性是针对时间序列数据提供的低延时数据写入及快速交互式查询的分布式数据库时间列是数据模型的核心组成部分它允许数据按时间进行排序分割和分片存储以支持高效的数据查询且可将数据按固定时间间隔小时天周划分为不同的桶每个桶存储一个时间段内的数据其与典型的部分特性类似这些时序数据库具备一些共同特点一是通过内存增量所有让数据写入即可查二是下采样或操作减少数据量在数据写入时就会对数据预聚合进而减少原始数据量三是可能会支持中用户可任意加可对新增进行聚合查询但在这点上跟略有差异需预定义数据打包在最后形成的数据文件中也就是说过去和未来数据的可以不同不同的数据可共存固然不是的但调整也是比较灵活的在时序数据上也有类似功能提供了全文检索的模式并提供访问原始事件级数据也提供了分析和汇总支持但根据研究在数据获取和聚集上资源消耗比在高侧重于工作流程以较低的成本设计了聚集和获取的高性能方案亿级百列数据查询时间是的提供了结构化事件数据的一些基本的搜索支持更偏重于数据汇总分析为了性能你开启了预聚合这会带来信息量的丢失因为的粒度会变成最小的数据可视化粒度如果以分钟粒度进行那么入库后能查看的数据最小粒度即为分钟级别设计是的一个关键抽象是一种不可变但有版本控制数据结构可看作是的第一个实现的不可修改性简化了的实现但若你有修改数据的需求重创建的过程是比较耗时的其能接受的数据结构相对简单不能处理嵌套结构的数据用架构分别处理实时数据和批量数据数据存储在中类似中的每个中按时间划分每个时间范围称为一个一般一天一个在一个中数据根据维度的或范围分成一个或多个每个都是一个单独文件通常含几百万行数据这些是按时间组织的所以在按时间查询时效率非常高实际上和都是抽象的底层存储就是一个生成后就无法被修改只能通过生成一个新来替代旧的的命名规则可帮助快速找到需要查的文件不同列的数据都单独保存一个文件的话会产生很多小文件严重影响文件系统读写性能因此每个字段数据生成好后会以二进制拼接的方式合成一个文件以提升性能在逻辑上不同列的数据存储是分开的在数据摄取准备时要敲定查询的最小粒度如查询最小粒度要分块文件粒度使用时会以多级缓存的方式使用除了可靠存储还会在内存中及服务器硬盘上加载作为缓存开启预聚合特性的内部也会不一样可大幅减少数据存储量提升查询效率关闭则中会保留写入的原始数据让在繁重的查询压力下保持良好的操作性能应让文件大小在至之间其在设计之初为了追求亚秒级的能力对精准去重计算不支持只提供近似查询在实时要求程度不高的情况下可通过时间换空间的方式对需要计算的字段做查询然后实现精确去重行数据结构剖析中每一行包含部分时间戳维度和指标时间戳就是该条数据产生或保存的时间主要作用有划分按照某种时间粒度预聚合数据等指标就是一些整数或浮点数值也可能是复杂数据结构如用来在查询时聚合得到结果维度相对复杂点因为在查询时要支持操作每列维度值会保存个数据结构来记录如行数据某列数值取值如下取值字典每个值映射为一个可理解为独热编码表行每一行取值的行数据的独热编码表示用于支持和查询每个取值对应的对和操作速度非常快在存储中会以方式压缩独热码表值在此列的位置分布位图索引再举例举一个更直观的例子如下表数据时间戳维度列指标列北京书北京电脑上海电脑广州手机杭州水果北京书将如上数据结构构建位图索引来实现快速查找原始值列值编码位图北京上海广州杭州书籍电脑手机水果北京电脑那么根据位图查询条件就是所标的行也就是第行设计讨论和的比较基本可归结为需要设计什么样的系统被设计为一直在线的服务所以其容灾扩容再平衡都做得很完备各种挂掉都不会使得停止工作但状态会无法更新可获取实时数据在查询速度方面是列存储方式数据经过压缩加入到索引结构中压缩增加了中数据存储能力能使适应更多的数据快速存储支持时间序列和样式的查询但不支持可认为是之上的后台程序缓存层基于或其它后备存储限制了数据获取的速度支持样式的查询是计算存储二者一肩挑设计是一个离线预处理框架依赖和做计算然后用保存预处理结果而后进行展示它们二者都对有依赖只把当做远程离线存储但实际计算过程并不使用而使用的是技术栈中间计算过程和最后计算结果里面都会用到有灵活的预聚合能力可利用算法做多维的聚合而则是使用强大的位图计算做了精确的计算能力新的与期待全频谱可平衡支持新一代数据平台系统需要形成一个从离线到实时的全频谱计算能力在的不可能三角里给用户提供多种不同平衡的选择面向未来的系统应能做到一套系统一套资源针对上述三个方向的不同平衡点为用户提供多种选项实现从离线到实时的全频谱数据网格是一种数据管理方法强调数据的分布式架构和以业务领域为中心的数据所有权和治理权促进数据的可访问性和质量从侧面也反映了以中央团队来管理数据搞不好数据量过大或中央数据管理人员对数据不够了解那么数据湖可能无法确保数据质量数据网格架构的基础理念是将数据视作有价值的产品那么数据的质量和完整性就成为数据管理的重点将企业内特定数据集的所有权和职责分散至具备专业知识的用户能深入了解并充分利用这些数据同时通过标准化和自动化来保证整体的一致性和互操作性发挥数据的价值另外数据湖的集中式架构数据检索流程和程序一直较复杂很容易出现瓶颈大量整合数据的管控工作全压到了一个团队肩上随着这些数据量和数据检索需求的增加这些团队会不堪重负合规任务也可能会被仓促了事引入潜在的风险和损失面向领域的所有权数据即产品自助式数据平台联邦计算治理防止数据孤岛赋能领域团队增加参与度减少领域孤立降低所有权成本通过互连数据产品获得更高阶价值网格级别一致可靠的策略执行产品思维应用于数据管理可发现可理解可信赖支持去中心化数据管理简化数据产品创建和使用过程通过自动化和计算实现政策执行平衡域自主性和全局互操作性数据安全数据本身已经成为一种资产有非常好的资产变现和产生额外价值的能力和需求同时数据很可能涉及隐私泄露这就形成了有关数据安全隐私保护和数据共享的矛盾在隐私和安全的情况下做到更好的数据共享和变现成了新热点数据安全不仅仅是一个权限问题还涉及很复杂的系统架构包括权限管理用户隔离存储加密异地备份敏感数据风险行为的识别安全共享这个方向包括两个核心场景一方数据对外共享多方数据共同计算第二点是多方的数据交叉计算或者叫联邦计算这里面包含两项核心技术一个是基于隐私计算的数据交互一个是基于联邦学习的数据交互不论是一方域内多租的安全模式还是跨域多方的安全共享模式目前都是领域热点时代的不同目前的大数据系统处理的数据主要是人的行为日志如浏览记录手机上对的点击操作等都会以日志形式传到系统中反馈给推荐系统广告系统后续接入网络的硬件设备的数据慢慢会超过人的数量数据处理也会成为一个热点但大多数时候设备数据并没有太多意义和价值只有出问题的时候数据才会产生波动这种情况下如何有效收集设备产生的数据海量数据无法全量上云需要在端侧做一定处理就成了新的需求也就是端云协同是的特点不过也实在没什么新鲜没有技术难度国内最大的互联网公司内部数据量均在级别作业量每天百万级别以上主流客户其实都在级的数据规模有些在百级别面对这么大的数据规模传统以人为轴来开展数据管理和优化的方式不再胜任这种复杂的数据组织和优化需更多的基于的自动化技术来完成如通过机器学习自动进行数据分层依据访问的统计判断什么样的数据更重要那些作业可放在冷存储上几朵乌云计算引擎的多样化最终能否诞生一套的引擎满足多样的计算需求兼顾通用性和效率现在大家几乎还是通过拼接不同引擎来搭建自己的计算平台如做批处理做流处理做交互分析再复杂点可能还要部署做查询用做文本检索虽每个单独产品已比较成熟但整个系统复杂度非常高这里面就蕴含着标题的期待基于开源自建还是选购企业级产品开源软件免费但需要独立的团队去支撑这一大数据平台的部署和运维带来相对较高的维护成本一个简答的公式是对于百台规模的平台基于开源软件自建的总物理硬件成本开发维护人力成本物理硬件成本头部的技术公司规模较大人力边际成本低非头部企业直接购买化企业级平台综合成本更低享受更好的性能安全性稳定性和兜底能力当然另一面就是技术黑盒和高改造成本需平台厂商来做的问题开箱即用全托管平台大受欢迎以开源生态为主线也形成广泛客户群体组装还是直接买笔记本答案在客户手中关系模型外是否会发展处其它主流计算范式数据库数仓已发展年主流计算范式就是二维关系表达近年深度学习带来新的计算方式有没有更新一代会产生图计算当前最被看好点边模型但数据库技术发展过程中也诞生了图计算模式且发展多年但目前仍不是主流但随着图学习的兴起是否会焕发新生值得期待大家都说软件工程师软件产业但需要从观念转变成观念在做任何设计和开发时要把放在第一位这样才是行业海量数据一直在增长但我们应想办法控制下来未来的趋势要考虑缩小海量数据而不是任凭它扩张太多初创企业陷入错误的逻辑大数据非结构化数据非结构化和半结构化数据的利用是呈现了爆炸式增长但也要注意到结构化数据的使用上也出现了指数式增长搞起来了自有人会来光顾这是错误的观念想用大数据创业业务专长必须有同时技术也必须保证是尖端的这些都是普通商户所缺乏的如何帮助非技术型用户在其日常工作中轻松使用数据才是问题的关键参考简单认识估算算法开源技术架构对比数据湖三剑客对比腾讯云存储格式腾讯云解读数据架构的腾讯云基于扩展数据湖能力的实践搜狐主流开源系统的分类及核心技术点搜狐主流开源引擎大比拼',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-01-21 10:23:15',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 6.3.0"></head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><a id="site-name" href="/" accesskey="h"><div class="title">Diffday</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><span> 归档</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><span> 分类</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本站</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/copyright/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 版权协议</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="http://cdn.diffday.com/picgo/wechatpay.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src="http://cdn.diffday.com/picgo/wechatpay.jpg"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="http://cdn.diffday.com/picgo/alipay-n.jpeg" target="_blank"><img class="post-qr-code-img" alt="支付宝" src="http://cdn.diffday.com/picgo/alipay-n.jpeg"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/10/"><span class="card-archive-list-date">十月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">九月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">2</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">6</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><!-- if (page.copyright_author && page.copyright_author !== config.author)// a.post-meta-original 转载--><!-- else--><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E4%BF%A1%E6%81%AF%E6%8A%80%E6%9C%AF/" itemprop="url">信息技术</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>大数据</span></a></span></div></div><h1 class="post-title" itemprop="name headline">数据中台与技术漫谈</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2022-01-13T03:37:06.000Z" title="发表于 2022-01-13 11:37:06">2022-01-13</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-01-21T02:23:15.000Z" title="更新于 2025-01-21 10:23:15">2025-01-21</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">15.3k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>48分钟</span></span><span class="post-meta-separator"></span><span class="post-meta-pv-cv" id="" data-flag-title="数据中台与技术漫谈"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="busuanzi_value_page_pv"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为深圳"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>深圳</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="http://cdn.diffday.com/picgo/20241023162552.png"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://blog.diffday.com/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0%E4%B8%8E%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88.html"><header><a class="post-meta-categories" href="/categories/%E4%BF%A1%E6%81%AF%E6%8A%80%E6%9C%AF/" itemprop="url">信息技术</a><a href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/" tabindex="-1" itemprop="url">大数据</a><h1 id="CrawlerTitle" itemprop="name headline">数据中台与技术漫谈</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">DiffDay</span><time itemprop="dateCreated datePublished" datetime="2022-01-13T03:37:06.000Z" title="发表于 2022-01-13 11:37:06">2022-01-13</time><time itemprop="dateCreated datePublished" datetime="2025-01-21T02:23:15.000Z" title="更新于 2025-01-21 10:23:15">2025-01-21</time></header><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/hint.css/2.4.1/hint.min.css"><p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://cdn.diffday.com/picgo/20241023162552.png" alt="数据中台"></p>
<h1>数据中台</h1>
<p>数据中台并不产生数据，而是将组织在业务中产生的全域数据，汇进数据中台建立一套标准，形成数据资产后再进行服务化，业务化的过程。</p>
<h2 id="目标">目标</h2>
<p>目标在于提升运营效率，决策效率，数据精准。对外支撑各种场景应用。</p>
<ul>
<li>在实施上把数据加工，存储，分析，建模等与数据相关的所有事情都可轻松的解决</li>
<li>从管理上把一切的数据，口径，项目，工程等都管理起来</li>
<li>面对客户，使客户一站式在此平台上获取到任何想要的数据，有足够的数据应用能力</li>
</ul>
<h3 id="价值锚定">价值锚定</h3>
<p>梳理业务场景：搞清楚中台如何对业务产生价值，回归到业务本质，<font color="dodgerblue">如何提升商业能力</font></p>
<h2 id="工作范畴">工作范畴</h2>
<p>工作内容涵盖：（1) 数据标准和指标建设 （2）数据采集（3）数据集成（4）数据治理（5）数据应用（6）数据资产管理（7）大数据仓库等技术应用</p>
<span id="more"></span>
<h2 id="能力建设">能力建设</h2>
<p><strong>复用性，资源整合，能力沉淀，数据深度整合沉淀为公共数据服务</strong>，这些能力在构建数据中台之初就是必须去直面的问题。</p>
<ul>
<li>
<p>能力沉淀：（1）数据接入能力（2）计算能力（3）存储能力（4）业务支撑能力（5）展现能力</p>
</li>
<li>
<p>数据域的建设，分为</p>
<ul>
<li>内容建设</li>
<li>工具建设：（1）ETL 过程（2）数据工具（3）调度工具（4）元数据工具（5）指标字典（6）库表字典（7）数据质量</li>
</ul>
</li>
</ul>
<blockquote>
<ul>
<li>
<p>内容价值探索，工具体系化建设是数据平台的基石，<font color="dodgerblue">内容透过工具提取出价值</font></p>
</li>
<li>
<p>指标字典：解决公司指标管理，口径管理的问题</p>
</li>
<li>
<p><font color="dodgerblue">每个工具产品解决特定领域的问题</font></p>
</li>
</ul>
</blockquote>
<h2 id="数据治理怎么强调都不为过">数据治理怎么强调都不为过</h2>
<p><strong>和业务独立开的数据治理少有成功的</strong>，治理需要跟业务场景紧密结合</p>
<ul>
<li>
<p>大的数据标准要有（数据资产目录），通过数据资产目录将共有的维度，共性的业务模型提炼出来</p>
</li>
<li>
<p>建立统一的企业级数据指标体系，解决数据来源多元化和标准不统一的问题。规范有序的完成数据采集，建模，分析，集成，应用和资产管理</p>
</li>
</ul>
<pre class="mermaid">block-beta
columns 5
a["应用"] block:application:4
	服务使用分析 服务提升建议 趋势分析 个性服务推荐 影响分析
end
v["可视化"] block:visualization:4
	报表 大屏
end
s["服务管理"] block:service:4
	服务创建 API 管理
end
m["资产管理"] block:management:4
	资产门户 标签管理 价值评估 标准管理
end
p["资产建设"] block:property:4
	数据交换 
	dd["数据开发"]
	算法建模
end
block:develop:5
	可视化开发IDE 任务发布管理 任务调度管理 任务运维监控
end
i["基础设施层"] block:infrastructure:4
	AWS S3 RDS ...
end
dd-->develop
data["各类数据源"]:5</pre>
<h3 id="算法建模管理">算法建模管理</h3>
<pre class="mermaid">block-beta
columns 7
a["分类"] block:a1:6
逻辑回归算法 SVM算法 ID3算法 C4.5算法 随机森林算法
end
b["回归"] block:b1:6
线性回归模型 朴素贝叶斯模型 Lasso回归模型 Ridge回归模型
end
c["聚类"] block:c1:6
K均值算法 高斯混合模型 DBSCAN算法 幂迭代聚类模型 隐含狄利克雷分布
end
d["关联降维"] block:d1:6
Apriori d2["FP-growth"] SVD奇异值分析 PCA主成分分析
end
e["时间序列"] block:e1:6
AR模型 MA模型 ARIMA模型 ARCH模型 GARCH模型
end
f["识别"] block:f1:6
产业舆情矩阵模型 产品价格弹性模型 产业聚集度模型 团伙分析模型 重点人员行为模型 商标相似度检测模型
end
g["预测"] block:g1:6
企业成长性模型 重要商品价格预测模型 钢铁企业融资模型 环境预警模型 销售订单预测模型
end
h["优化"] block:h1:6
资本热度模型 景气指数模型 克强指数模型 扶贫资金分配优化模型
end</pre>
<h2 id="团队划分">团队划分</h2>
<ul>
<li>业务专家团队+数据治理团队</li>
<li>数据工程团队（平台）+数据分析团队</li>
<li>智能算法团队</li>
</ul>
<blockquote>
<p>数据中台和数据平台有一个潜台词的区别，就是最终会有数据服务化的目标，提高数据共享能力，治理的好避免数据的重复计算</p>
</blockquote>
<p><font color="blur">一般一上来就喊中台化的基本入不敷出，不是人员投入问题，就是实施方向以及定位到底是什么不明确</font>，有的企业用演进的办法来做实施是个非常不错的选择。</p>
<p>失败的数据中台常碰到如下问题</p>
<ol>
<li>「人的争斗」：有几方人/势力都想驱动这个平台，想法太多</li>
<li>「能力问题」：做中台难度和普通产品比，有量级的差异，能力不足，真搬不动这块石头还砸自己的脚</li>
<li>「头疼医头」：原本一条线到头的建设，实际上变成头痛医头的复杂网建设</li>
<li>「高投低产」：资源问题，产研几十位，运营几十，数据人员几十，审核人员可能上百，算上流动，前后大概可能有好几百人。<font color="tomato">如果一开始给了老板很高的预期，希望花一年的时间几十人就能完成中台的建设，到头来不断降低预期，投入产出比不断透支，可想最终的结果</font></li>
</ol>
<h2 id="数字化转型，忐忑艰苦">数字化转型，忐忑艰苦</h2>
<h3 id="指导思想">指导思想</h3>
<p>被动响应转主动建设，修炼内功，降本增效</p>
<ul>
<li>工具建设提升自身效率（标准化，组件化，内部运营工具）</li>
<li>沉淀优化内容建设</li>
<li>围绕业务场景化做敏捷探索</li>
</ul>
<h3 id="总结与例说">总结与例说</h3>
<p><font color="dodgerblue">综合言之：<u>支持</u><code>业务商业模式</code>不停<code>快速尝试</code>下的<u>数据场景化需求</u>，还要进行自身内容与工具化建设，拆解历史包袱 !</font></p>
<p>系统化$\longrightarrow$业务在线化$\longrightarrow$业务信息化$\longrightarrow$数据整合化$\longrightarrow$业务智能化；也有企业信息化能一部到位，毕竟这样的很少，更多是原来资源的整合升级</p>
<p><strong>举例</strong>：</p>
<ul>
<li>
<p>定制化的数据产品改成了可配置化，持续做减法，表从近万张缩减到几千张，成千的指标一样做缩减</p>
</li>
<li>
<p>通过该数据做数据作战地图–数据产品的方式来做数据模型的阶段性布局和设计（定优先策略）</p>
</li>
</ul>
<h2 id="过去的债务">过去的债务</h2>
<p>在过去企业构建IT基础设施的过程中，逐渐形成了各种烟囱式的数据设施，也带来了数据孤岛问题，还有一点可怕的事是：<font color="blur"><strong>ETL任务和中间过程大量膨胀</strong></font>，不仅是存储问题，<font color="tomato">更大的挑战是无数的ETL任务其实不断地做重复性的工作，不断消耗整个数据集群的资源，还存在数据口径不一致的问题</font>。数据来源又可能有分歧，如这个部门说自己是从PowerBI中看到的，另一个部门说是从数仓里看到的，这就不能帮助企业做出高效的决策。</p>
<p>过去上了ERP到电子化时，就有一个企业流程再造的说法，就是说你<strong>上系统要先梳理自己的业务流程</strong>，梳理不好系统上不去，也没法提升管理能力。<strong>现在和那个阶段有一点味道相像，一样要先将企业的指标，数字化运营的思路理清楚</strong>，如果讲不清业务目标，过程目标，结果目标，那就不知道拿什么追踪，<u>拿什么来做数字化的管理</u>？</p>
<p><font color="blur">各部门各组织都非常有欲望生产自己的数据指标，会形成几百倍的放大</font>。<strong>不同部门指标不统一，指标过时，都属于管理问题</strong>。</p>
<h1>古早技术概念介绍</h1>
<h2 id="数仓的星型和雪花模型（多表组合模型）">数仓的星型和雪花模型（多表组合模型）</h2>
<p>区别就是对维度表的拆分，雪花模型维度表设计更加规范，一般符合第三范式；而星型一般采用降维操作，用冗余避免模型过于复杂，提高易用性和分析效率。</p>
<p><font color="tomato">在数据仓库中多用星型模型</font>，构建宽表，维度整合，<strong>减少多表关联</strong>，方便性能高。</p>
<p>在数据采集中，要注意完整性校验，针对缺失字段的数据建议直接丢掉，也可以用同列前/后一个数据来填补。还要注意合法性校验，异常值全部替换为一个特殊值（特殊值这要根据具体的业务场景而定）</p>
<h2 id="宽表模型和多表组合模型">宽表模型和多表组合模型</h2>
<table>
<thead>
<tr>
<th>宽表型</th>
<th>组合模型</th>
</tr>
</thead>
<tbody>
<tr>
<td>Elasticsearch、Solr<br/>应用Scatter-Gather计算模型</td>
<td>GreenPlum</td>
</tr>
<tr>
<td>ClickHouse</td>
<td>Presto</td>
</tr>
<tr>
<td>Druid</td>
<td>Impala</td>
</tr>
</tbody>
</table>
<p>宽表模型能提供比多表模型更好的查询性能，不足的是支持的 SQL 操作类型比较有限，如对 Join 等复杂操作支持较弱或不支持。</p>
<p>多表组合模型一般均基于 MPP 架构，相较其它类型的 ROLAP 和 MOLAP，通常不具有性能优势，实时性较一般。但其支持的数据量大，支持 SQL 类型多样，这样通用系统往往比专用系统更难实现和进行优化。</p>
<p>基于明细数据的多维模型、雪花模型能支持业务灵活用数问题，但性能问题令人头疼，ROLAP 开发简单但效率完全依靠数据库本身，当数据量到一定程度后很难保证性能，所以又出现了大量为解决性能而开发的报表物理表（宽表），MOLAP 能解决效率方面很多问题，但相对于 ROLAP 会带来管理运维成本的增加。</p>
<h2 id="基数估计">基数估计</h2>
<p>Cardinality Estimation一直是大数据领域的重要问题之一：一批数据中，不重复的元素有多少个。以 UV 为例，对访问量巨大的系统来说，统计出 10 亿和 10 亿零 10w 其实没太多的区别，因此，在这种业务场景下，为了节省成本，可只计算出一个大概的值，没必要算出精准的值。</p>
<p>大家常规用字典的数据结构，遍历字典后，得到的整体计数就是这批数据的基数了。这种算法虽然精准度很高，但使用的空间复杂度却很高，故提出一些近似方法，估算数据集合的基数。如 HyperLogLog，MinCount，ThetaSketch</p>
<h2 id="OLTP-vs-OLAP">OLTP vs OLAP</h2>
<ul>
<li>
<p>与 OLAP 不同，<font color="dodgerblue"><strong>OLTP 系统强调数据库内存效率</strong></font>，<em>强调内存各种指标的命中率，强调并发操作，强调事务性</em></p>
</li>
<li>
<p><strong>OLAP 系统则强调数据分析，强调磁盘 I/O，强调分区</strong>。它是一种让用户可以用不同视角方便快捷分析数据的计算方法，主流 OLAP 可分为三类</p>
<ol>
<li>
<p>MOLAP：多维 OLAP，Multi-dimensional：典型代表是：Druid，Kylin，Doris，它们<strong>一般会根据用户定义的数据维度，度量（也可以叫做指标）在数据写入时生成预聚合数据；<strong>Query 查的是预聚合数据而不是原始明细数据，不支持明确数据的查询，仅适合这种查询场景相对固定且对查询性能要求非常高的场景。其</strong>优缺点都来自于其数据预处理环节</strong>，预聚合处理需预先定义维度，会限制后期数据查询的灵活性，如果查询工作涉及新的指标，需重新增加预处理流程。</p>
</li>
<li>
<p>ROLAP：关系型 OLAP，Relational。典型代表是：Presto，Impala，GreenPlum，Clickhouse，ES，Hive，SparkSQL，FlinkSQL。数据写入时，ROLAP 并未应用像 MOLAP 那样的预聚合技术，<strong>ROLAP 收到 Query 请求时，会生成执行计划</strong>，扫描数据，执行关系型算子，在原始数据上做过滤，聚合，关联，分组，排序，<strong>整个过程都是即时计算，拼的都是资源和算力的大小</strong>。ROLAP 不需要进行预处理，因此查询灵活，可扩展性好，这类引擎使用 MPP 架构（与 Hadoop 相似的大型并行处理架构，可通过扩大并发来增加计算资源），可高效处理大量数据。有人说 Spark SQL 和 Flink SQL 属于 DAG 模型，其实 DAG 并不算一种单独的模型，它只是生成执行计划的一种方式。</p>
<blockquote>
<p>Hive执行 ad-hoc 查询慢的痛点，推动了 MPP 内存迭代和 DAG 计算模型的发展。</p>
<p>MPP减少 IO资源消耗，充分利用 CPU 资源，但事情往往是两面的。中间结果不落盘，正常情况是利好，异常情况如出现节点宕机，需要重新计算中间结果，拖慢任务完成时间。另扩展性没有 MR 架构好，随着 MPP 系统节点增多到一定规模，源于木桶效应，性能无法线性提升，且规模越大，出现宕机、坏盘等异常情况就会愈频繁，会导致 SQL 重试概率提升。所以 MPP比较适合执行时间不会太久的业务场景，如数小时，因为时间月越久，故障概率越大。</p>
</blockquote>
</li>
<li>
<p>HOLAP：混合 OLAP，Hybrid。将聚合信息存储在 OLAP 服务器上，详细记录保留在关系表中，因此不会保留重复副本，平衡了磁盘空间需求。劣势正是同时支持 MOLAP 和 ROLAP，本身体系结构非常复杂。</p>
<blockquote>
<p>或者换种说法其允许模型升级者决定哪些数据存储在 MOLAP 中，哪些数据存储在 ROLAP 中，把数据划分成传统关系型存储（细节数据）和专有存储（聚合数据）</p>
</blockquote>
</li>
</ol>
</li>
</ul>
<h3 id="OLAP-脑图">OLAP 脑图</h3>
<pre class="mermaid">mindmap
	root((OLAP))
		ROLAP)ROLAP(
			MPPDB
				Doris/StarRocks
				ClickHouse
				GreenPlum
			SQL-On-HadoopNaN
				MPP架构))MPP架构((
					Presto
					Impala
					Drill
					HAWQ
				通用型))通用型((
					Hive
					SparkSQL
		MOLAP
			Kylin
			Druid
		HOLAP
			Microsoft SQL Server Analysis Services</pre>
<h3 id="并发差异">并发差异</h3>
<p>在 OLAP 场景，一般认为 QPS 达到1000+就算高并发，而不是 10w 以上才算，毕竟数据分析场景，数据海量，计算复杂，达到 1000 已经非常不易。</p>
<p>如 Clickhouse 在 TB 级别，单集群达到 100 已经很困难，更适合企业内部 BI 报表使用，而不是广告主平台报表。Clickhouse 的执行模型决定了它会尽全力来执行一个 query，而不是同时执行很多 query</p>
<h2 id="Hadoop的调度演进">Hadoop的调度演进</h2>
<p>在 Hadoop1 中，MapReduce计算框架既负责集群资源调度，还负责 MapReduce 程序运行，资源调度和计算的高度绑定耦合。</p>
<p>到了 Hadoop2 改成了Yarn+MapReduce 的架构，这样就保证 Hadoop 集群既能跑 MapReduce 计算任务，还能跑任何支持 Yarn 资源调度的计算任务，如 Spark，Storm 等。</p>
<h2 id="大数据架构">大数据架构</h2>
<h3 id="Lambda-架构">Lambda 架构</h3>
<ul>
<li>同一套指标需开发两套代码进行在线和离线分析，维护复杂。</li>
<li>数据应用查询指标可能需同时查询离线数据和在线数据，开发复杂。</li>
<li>两套引擎（流+批），运维复杂</li>
<li>数据更新要 overwrite 整张表或分区，成本高</li>
</ul>
<p>随着在线分析业务越越多，Lambda 架构的弊端越发明显，增加一个指标要在线、离线分别开发，离线指标还可能和在线指标对不齐，部署复杂，组件繁多。真是一个痛苦的时代。</p>
<h3 id="Kappa-架构">Kappa 架构</h3>
<p>使用同套引擎同时处理在线和离线数据，数据存储在消息队列上。也有其局限：</p>
<ol>
<li>消息队列的容量特性使得历史数据可能无法回溯；数据可能乱序，可能对部分时序要求严格的应用造成数据错误。</li>
<li>流计算引擎批处理能力较弱，处理大数据量性能较弱。</li>
<li>从消息队列取数没有 SQL 自然，需要开发适配，开发复杂。</li>
</ol>
<h1>湖仓一体化</h1>
<h2 id="实时数仓">实时数仓</h2>
<h3 id="三大当红国际派">三大当红国际派</h3>
<p>基于 Lambda 和 Kappa 架构的缺陷，凸显了在大数据领域，实时数仓的建设和维护非常重要。Uber 孵化的Hudi，Databricks 孵化的 Delta lake，Netflix 孵化的 Iceberg 都在尝试解决此问题。三者均为 Data Lake 的数据存储中间层。</p>
<blockquote>
<ul>
<li>
<p>Hudi为了解决 uber 的增量 upserts问题；</p>
</li>
<li>
<p>Iceberg 诞生于Netflix, 旨在解决文件列表等云存储规模问题（当时是 S3 上存储大型 Hive 分区数据集时出现的性能，可扩展性和可管理性挑战），定位高性能分析与可靠的数据管理；</p>
</li>
<li>
<p>Delta 定位流批一体的数据处理</p>
</li>
</ul>
</blockquote>
<p>三种场景的不同造成三者设计上的差别。Delta 在数据 Merge 方面性能不及 hudi，查询性能不如 Iceberg，但与 spark 整合好，工作场景多。<u>从字节和亚马逊的实践上看，当前上下游生态的开放性和成熟度上，对全局索引的支持，对某些存储逻辑的定制化开发接口，Hudi 暂胜一筹</u>。如 hudi 有强大的数据摄取实用程序deltaStreamer允许你从各种来源增来摄取上游更改。</p>
<ul>
<li>三者都支持数据可变更，并发控制也都支持的不错。其中 Hudi 相比较另两个还支持 Merge on Read，能更好应对流式场景，减少写放大的发生。</li>
<li>在元数据变更上，Iceberg 很有优势，其设计能进行Full Schema Evolution，可任意地改变列的位置，类型，还提供 Partition Evolution，能帮助更好地管理数据。另两个引擎，Delta 只能与 Spark 结合，利用了 SparkSQL 的 Schema，Hudi 同样直接使用 SparkSQL 或 FlinkSQL 的 Schema，在 Schema Evolution 上比较弱，只支持在最后新增列。</li>
<li>在多引擎支持方面，Iceberg 原生设计就为了支持多引擎，分层设计很好，想增加一个新的引擎时就很简单。Delta 和 Spark 绑定骄较深，移植困难。Hudi 支持多引擎，只是支持别的引擎的话，增加代码会比较多，需从底层往上垒代码</li>
<li>对后端存储的支持，Iceberg 对后端存储之要求简单的三点，不管是分布式存储还是对象存储大多数都支持。Delta 相比 Icegerg，它的 Constant Listing 是比较严格的要求，有些对象存储可能满足不了。Hudi 并未对存储有什么具体要求，只要你实现一个 Hadoop FileSystem API，就可以跑 Hudi<sup id="fnref:6"><a href="#fn:6" rel="footnote"><span class="hint--top hint--error hint--medium hint--rounded hint--bounce" aria-label="腾讯云 [基于 Iceberg 扩展 Doris 数据湖能力的实践](https://cloud.tencent.com/developer/article/2005918)
">[6]</span></a></sup></li>
</ul>
<p>对于数据湖，大家可能进行数据探索和开发，如果你的存储格式在并发读/并发写（包括元数据变更）上不友好，在任务编排上就会出现很大的局限性。另外最好对多种计算引擎都亲和支持，以方便拥抱技术调整，还有一点比较重要的是部署和存储选择灵活，HDFS，云托管，对象存储也支持。</p>
<h3 id="多记一嘴-Hudi">多记一嘴 Hudi</h3>
<p>Hudi 和 Hive 间的关系是相互依赖的，Hudi 作为数据管理工具，可将数据以 Hudi 表的形式存储到 HDFS中，而 Hive 可通过 Hive 表的方式对 Hudi 表进行查询和分析。可理解为 Hudi 赋能了 Hive 表增量更新和删除的能力，且相较于几种原始表存储格式有更高效的索引实现。它本质上是在大数据存储上的一个数据集，使得用户能在 Hadoop 兼容的存储上存储大量数据（其实也可以不依赖 hadoop。可以用操作系统的文件系统存储，但为了分析性能和数据可靠性，一般都搭配 HDFS），对上可暴露成一个普通的 Hive 表或 Spark 表，通过 API 或命令行可以获取到增量修改的信息，且保管了修改历史，可做时间旅行或回退。</p>
<blockquote>
<p>Hudi 以两种不同的存储格式：读优化的列存格式 ROFormat，缺省值是 Parquet；写优化的行存格式，缺省值是 Avro</p>
</blockquote>
<h3 id="Doris">Doris</h3>
<p>Doris是一个 MPP（大规模并行处理框架-Massively Parallel Processing） 架构的分析型数据库，孵化于百度的 Palo，是根据 Google Mesa 论文和 Impala 项目改写的一个大数据分析引擎「架构整合 Google Mesa + Apache Impala + ORC列式存储三种技术，通过 Mesa 实现预聚合，Impala 实现 MPP连接处理，ORC 列存储更好服务 OLAP 数据分析」，兼容标准 SQL 且完全兼容 MySQL 协议，运维部署难度不高（只有 FE：负责管理元数据、解析 SQL 生成和调度查询计划+BE：存储数据及执行 FE 生成的查询计划 两种组件）。简单易用，多副本的机制减少数据网络拷贝，将数据进行分区分桶后分发散列到各个节点实现分布式计算，亚秒级获得查询结果，有效支持实时数据分析。</p>
<p>支持批量数据和流式数据 load ，支持数据更新，支持聚合表和物化视图，特点是采用了预聚合技术，向量化执行引擎（ShareNothing 架构，且在数据写入时建立多级索引，将任务并行分散到多个服务器和节点上，结合单节点的多核并行处理能力，在每个节点计算完成后，将各部分结果汇总在一起得到最终结果），再加上列式存储，是一个高效的查询引擎，如果你数据量比较小，可在 Doris 里完成一站式分析。</p>
<p>但当数据量变大时，ETL 和分析都在 Doris 里进行时，会相互影响性能，这时势必要将 ETL 任务分摊出去，外挂湖。</p>
<h3 id="Kudu">Kudu</h3>
<p>Kudu 需要单独部署集群，Hudi 则不需要，还有个关键区别是 Kudu 还试图充当 OLTP 的工作负载和数据存储，且 Kudu 虽然支持更新，但不支持增量拉取，在增量自动处理方面 Hudi要方便的多。</p>
<p>Kudu 于分布式文件系统抽象和 HDFS 完全不同，它自己的一组存储服务器通过 RAFT 相互通信，Hudi 则与 Hadoop 兼容的文件系统(HDFS,S3,Ceph)可一起使用。</p>
<p>不同于Hudi 或 Delta Lake 是作为数据湖的存储方案，Kudu 设计初衷是作为 Hive 和 HBase 的折中，同时具有随机读写和批量分析的特性。但相较于前两者，Kudu 不支持云存储，版本回滚和增量处理。</p>
<h3 id="总结">总结</h3>
<p>新技术的出现使得数仓支持 ACID、Update/Delete、数据 Time Travel、Schema Evolution 等特性，使得数仓的时效性从小时级提升到分钟级，支持部分更新，兼具流计算的实时性和批计算的吞吐性，支持近实时场景。</p>
<p>但也要认识到数据湖模式无法支撑更高的秒级实时性，也无法直接对外提供数据服务，需要搭建其他的数据服务组件。</p>
<h2 id="湖仓对比">湖仓对比</h2>
<table>
<thead>
<tr>
<th>对比维度</th>
<th>数据湖</th>
<th>数据仓库</th>
</tr>
</thead>
<tbody>
<tr>
<td>方法论</td>
<td>事后建模（schema-on-read）</td>
<td>事前建模（schema-on-write）</td>
</tr>
<tr>
<td>存储类型</td>
<td>结构化/半结构化/非结构化（文件）</td>
<td>结构化/半结构化（表）</td>
</tr>
<tr>
<td>计算引擎</td>
<td>向所有引擎开放，各引擎有限优化</td>
<td>向特定引擎开放，易获得高度优化</td>
</tr>
<tr>
<td>成本</td>
<td>易启动，难运维管理</td>
<td>难启动，易运维管理</td>
</tr>
<tr>
<td>数据治理</td>
<td>质量低，难管理使用</td>
<td>质量高，易管理使用</td>
</tr>
</tbody>
</table>
<p><strong>随着数据量的增长，运维管理会越来越困难</strong>，所以有很多数据湖最终有可能变成<font color="red">数据沼泽</font>（比如，大家也不知道这个数据属于谁，谁被谁来用，能不能删掉，该怎么治理），这是数据湖面临的一个问题。</p>
<p>大多数数据仓库建立之初要有一个有关整体数据建模的顶层设计，所以数据仓库的启动成本很高。但这种很好的顶层设计，会使数据仓库日后扩展时的运维和管理成本变得更低，长线成本优势变得非常明显。（但数仓在面对AI这种非结构化数据存在很大挑战，它几乎不支持音视图类型的数据，而数据湖可存储所有类型，更灵活更有优势）</p>
<h2 id="融合流派（Data-Lakehouse）">融合流派（Data Lakehouse）</h2>
<h3 id="数据复杂性与管理挑战">数据复杂性与管理挑战</h3>
<p>51%的受访者报告他们有 20 到 100 个或更多的数据源，显示了数据整合和管理的复杂性。</p>
<p>湖仓架构通过减少数据移动和数据副本，提高了查询速度并降低了成本，大型企业预计能节省成本 75%以上，56%的受访者也觉得他们能节省 50%以上的分析成本。</p>
<h3 id="体系融合">体系融合</h3>
<p>这<strong>两个体系可以说是硬币的两面</strong>，很多厂商开始考虑怎么在数据湖上应用更多数据仓库技术，反过来数据仓库厂商也希望用数据湖技术使自己更开放，这两个技术在相互学习和融合，也就造出一个新名词—湖仓一体。</p>
<blockquote>
<p>一种将数据湖的灵活性和数据仓库的结构化查询能力相结合的架构，支持各种数据类型的高效存储和分析</p>
</blockquote>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="http://cdn.diffday.com/picgo/20241023172121.png" alt="湖仓一体"></p>
<p>有两个流派，双方都在发展中：</p>
<ol>
<li>「仓外挂湖」左边一个数据仓库，右边一个数据湖，中间以高速网络相连形成联动，这种流派的代表是AWS的Redshift。</li>
<li>另一个流派是数据湖向数据仓库演进「湖上建仓」，整体架构师在数据湖上搭建数据仓库，阿里云的Maxcompute，Databricks是代表</li>
</ol>
<h2 id="总结-vs-预测">总结 vs 预测</h2>
<p>大数据平台的发展在很长一段时间几乎都是以分析（BI）为轴，主流接口是SQL，侧重结构化的数据和二维关系表达的运算模式，以历史数据为主，在之上做统计和分析。</p>
<p>非结构化的数据处理过去一直是瓶颈，但10年前的深度学习技术突破了这一瓶颈，在过去5年中，算法类负载在数据中心里从一个很低的比例增长到10~30%，正式成为数据平台的一等公民。</p>
<p><strong>说数据分析和BI侧重于历史数据总结，算法和AI具备越来越好的面向未来做预测的能力，该说法有合理性</strong>。</p>
<h1>OLAP 查询引擎</h1>
<h2 id="古早实时数据探索系统的问题">古早实时数据探索系统的问题</h2>
<p>第一代的实时数据探索通常是 Spark+Redis+Hbase 的方案，存在下述问题</p>
<ol>
<li>流量高峰期处理延迟</li>
<li>纬度交叉分析不灵活</li>
<li>消耗资源大，碰到系统故障时，重算慢</li>
</ol>
<p>在大内存情况下很容易崩溃，哪天一个硬件故障，一天的数据可能要重算，算一天需要十几个小时。</p>
<h2 id="新质生产力对比">新质生产力对比</h2>
<p>在传统的数据仓库架构中，ETL 是在数据仓库之外，OLAP 在数据仓库之内的，Hadoop 体系引入数据仓库领域后，大大提升了数据 ETL 处理的能力，集群的扩展能力，数据存储的稳定性，但是牺牲了数据的查询能力。</p>
<ul>
<li>
<p>Kylin，Presto，Impala，Druid 都是为了解决 OLAP 查询而设计的，但这些基于 HDFS 设计的 OLAP 引擎只是加速了查询速度，未能达到令人惊艳的速度，ClickHouse 和 Doris 在速度方面更胜一筹。</p>
</li>
<li>
<p>Presto，Impala，Greenplum 在支持的 SQL 计算上更为通用，更适合 Ad Hoc 场景，然而这些通用系统往往比专用系统更难做性能优化，所以不太适合做 $QPS &gt; 1000$ &amp; $Latency &lt; 500ms$的在线服务，更适合做公司内部的查询服务和加速 Hive 查询的服务。</p>
</li>
<li>
<p>TiDB 是一套 OLTP+OLAP 的数据库，但作为非独立 OLAP，分析处理能力并不理想，性能在不同场景下表现参差不齐。</p>
</li>
</ul>
<p>当时间回到 2017 年，市场上找开源 OLAP工具就像在非洲大草原上找树一样，寥寥无几，可能只有 Druid 或 Kylin，Kylin的最佳存储引擎为 HBase，预计算查询效率出色，但预计算带来的维度爆炸会给存储带来一定压力（有 N 个维度，就会有 2<sup>N</sup> 种组合，所以最好控制好维度的数量）。Druid 也有缺点，对 Join 支持弱，组件众多需大量安装维护工作，侵入 Hadoop 的 Jar 依赖，精确去重较慢。</p>
<h2 id="细说说一众引擎">细说说一众引擎</h2>
<p>Presto（适合秒级查询），Impala，Druid，Kylin（专注预计算，最初由 eBay 开发并开源贡献)，Doris 和 Clickhouse（实时数据更新和高吞吐写入，但多表Join查询支持性能不好，并发较低），GreenPlum有较好的生态，但作为老将应对超大规模数据已显颓势。</p>
<h3 id="Presto">Presto</h3>
<p>Presto 是 MPP+SQL on Hadoo，它的设计和编写完全是为了解决像 Meta 这样规模的商业数据仓库的交互式分析和处理速度问题，它不是一个数据库，是一个运行在多台服务器上的分布式系统，命令行把 CLI 提交给 Coordinator 解析，分发处理队列到 Worker，将多个数据源进行合并，跨越整个组织进行分析，主要用来处理响应时间小于 1 秒到几分钟的场景。并没有使用 MapReduce，而是通过一个定制的查询和执行引擎来完成，所有的查询处理在内存中，所以性能较 Hive 快很多，但多张大表关联操作时易引起内存溢出错误。</p>
<p>实际体验结果：查询延迟一般，因为它是从明细层开始查询，没有任何预聚合</p>
<h3 id="Impala">Impala</h3>
<p>Impala 是 Cloudera 受到 Google Dremel 启发主导开发的 Hive 的升级品，不同于 Hive 的原始 MapDeduce 过程，提供访问 Hadoop 文件系统中数据的最快方法，但不能读取自定义二进制文件，仅限于文本文件。</p>
<p>Impala使用 Hive 的元数据，完全在内存中进行计算，是 CDH 平台当时首选的PB 级大数据实时查询分析引擎。通常搭配存储引擎 Kudu 一起提供服务，最大优势是点查比较快，且支持数据的 update 和 Delete。</p>
<h3 id="ClickHouse">ClickHouse</h3>
<p>ClickHouse由俄罗斯yandex公司开发。专为在线数据分析而设计。Yandex是俄罗斯搜索引擎公司，日处理记录数”十亿级”。其从 OLAP 场景需求出发，定制一套全新高效列式存储引擎，实现了数据有序存储、主键索引、稀疏索引、数据 Sharding、数据 Partitioning、TTL、主备复制等丰富功能，用C++实现，<font color="tomato">具备向量化执行，剪枝等优化能力</font>，具备强劲的查询性能。不依赖 Hadoop 体系（HDFS+YARN），比较擅长的地方是对大数据量单表进行聚合查询，比较适合内部 BI 报表型应用，可提供 ms 级别的响应速度。</p>
<blockquote>
<p>今日头条内部用 Clickhouse 做用户行为分析，内部一共几千个ClickHouse节点，单集群最大 1200 节点，总数据量几十 PB，日增原始数据 300TB 左右</p>
<p>腾讯也用ClickHouse做游戏数据分析，并建立一整套监控运维体系</p>
<p>携程内部从 18 年 7 月开始试用，现24 年每天数据增量十多亿，近百万次查询请求</p>
<p>快手内部也在使用，存储总量大约 10PB，每天新增 200TB，90%查询小于3秒</p>
</blockquote>
<p>ClickHouse 作为目前所有开源MPP计算框架中计算速度最快的，它在做多列的表，同时行数很多的表的查询时，性能是很让人兴奋的，但是在做多表的join时，它的性能是不如单宽表查询的。性能测试结果表明ClickHouse在单表查询方面表现出很大的性能优势，但是在多表查询中性能却比较差，不如Presto、Impala、HAWQ的效果好。</p>
<p>单表查询性能对比 Presto，Impala包括 Doris，确实要高很多。<font color="blur">但 Clickhouse 没有高速低延迟的更新和删除方法</font>，行级别的更新删除方法一般都是异步进行。</p>
<h3 id="Greenplum">Greenplum</h3>
<p>GreenPlum在基于PostgreSQL9.4开发，采用 MPP架构的关系型分布式数据库。其SQL支持，特性，配置选项和最终用户功能在大部分情况下和PostgreSQL非常相似。相比较，GreePlum可以使用追加优化（append-optimized）的存储格式来批量转载和读取数据，且能提供HEAP表上的性能优势。追加优化的存储为数据保护，压缩和行/列方向提提供了校验和。行式和列式追加优化的表都可以被压缩。 Greenplum的interconnect（网络层）允许在不同的PostgreSQL实例之间通讯，让系统表现为一个逻辑数据库。也包括为针对商业智能（BI）负载优化PostgreSQL而设计的特性。</p>
<p>提取下GreePlum和 PG 的主要区别：</p>
<ol>
<li>在基于Postgres查询规划器的常规查询规划器之外，可以利用GPORCA进行查询规划</li>
<li>可以使用追加优化的存储</li>
<li>可选用列式存储，只能和追加优化表一起使用。在所有使用列式存储的追加优化表上都提供了压缩</li>
</ol>
<h4 id="优势">优势</h4>
<p>有完善的生态系统，可以与很多企业级产品集成，譬如SAS，Cognos，Informatic，Tableau等；也可以很多种开源软件集成，譬如Pentaho,Talend 等。从应用编程接口上讲，它支持ODBC和JDBC。完善的标准支持使得系统开发、维护和管理都大为方便。支持分布式事务，支持ACID。保证数据的强一致性。</p>
<p>作为关系型数据库产品，它的特点主要就是查询速度快，数据装载速度快，批量DML处理快。而且性能可以随着硬件的添加，呈线性增加，拥有非常良好的可扩展性。因此，它主要适用于面向分析的应用。比如构建企业级ODS/EDW，或者数据集市等</p>
<h4 id="劣势">劣势</h4>
<p>Greenplum无法对实时数据进行增量聚合计算，难支持实时数据分析，数据扩容时需进行数据重分布，需人工操作且工作量大，影响线上服务。前端采用 cognos query studio 作为自由拖拽，实现灵活查询和效率之间的一个相互平衡和制约，查询效率不会太高，业务更关心的是能出数而不是效率本身。</p>
<p>但在这个年代选择多了，Greenplum 已经不流行了，但在大数据体系成熟之前，在 10 年之前，还是有很多公司引入其做基础数据仓库，不乏银行金融机构，淘宝，支付宝等。</p>
<h3 id="Druid">Druid</h3>
<p>Druid由 MetaMarkets（一家广告数据分析平台公司） 开发并于 2015 年开源，创建的最初意图是为了解决查询延迟问题，毕竟使用 Hadoop 来实现交互式实时查询分析很难，Druid 在这方面提供了以交互式访问数据的能力，并权衡了查询的灵活性而采取了特殊的存储格式。它的核心架构吸收结合了数仓，时序数据库及检索系统的优势。</p>
<p>其功能介于 PowerDrill 和 Dremel 之间，几乎实现了 Dremel 的全部功能，且从 PowerDrill 吸收了一些有趣的数据格式，在二者基础上增加了一些新特性，如为局部嵌套数据结构提供列式存储格式，实时摄取[收录事件]和查询（事件创建后毫秒/秒内查到），高容错的分布式体系架构等，每天能处理数十亿事件和 TB 级数据。其应用最广的是广告分析（点击流分析），广告监控及网络监控等，<strong>最适合应用于面向事件类型的数据，数据插入频率较高，但较少更新数据</strong>。</p>
<p>多数查询场景为聚合查询和 groupby分组查询，数据具有时间属性（Druid 对时间做了优化设计），需要对高基维度数据列（URL，用户 ID等）进行快速计数和排序，需要从 Kafka，HDFS，对象存储中加载数据。无论何种查询，历史节点都会先将相关 Segment 数据文件从磁盘加载到内存，然后再提供查询服务，历史节点的查询效率受内存空间影响很大，内存越大，需从磁盘加载数据的次数就越少，查询速度就越快。</p>
<p>目前 Druid 在实际应用中遇到的最大问题是缺少支持精确的基数计算的数据结构。Druid 的架构组件比较复杂（协调器，历史节点，实时节点），部署和运维成本较高。对 SQL 的支持不够全面，某些复杂查询可能要自定义实现。</p>
<blockquote>
<p>Druid 有三个外部依赖：Mysql 存储各种 metadata，存储 Segment 的载体（本地磁盘，NFS，HDFS，S3 均可），Zookeeper 管理当前 cluster 的状态，如哪些 Segment 由Real-time node 移到了Historical nodes。</p>
</blockquote>
<h4 id="不适合的场景">不适合的场景</h4>
<p><font color="blur">如果你需要对现有数据进行低延迟的更新操作，就不太合适用 Druid 了</font>，它支持流式插入（流数据摄入后会以 Index 形式保存在内存中，定期将 Index 序列化成 Segment 文件持久化到可靠存储中-如 HDFS），但不支持流式更新（更新通过后台批处理作业完成）。批数据摄入则会直接生成 Segment 存储，供服务加载使用。</p>
<p>其查询并发有限，不适合 OLTP 查询，不支持 join 使得只适合处理星型模型的数据，实时数据要能容忍丢失数据。</p>
<h2 id="OLAP-的实现模式">OLAP 的实现模式</h2>
<p>作为一个 OLAP 数据库，需要支持类似上卷，切块，切片，下钻等操作，但不适合明细查询（根据某主键 id 定位唯一数据的任务），常见的 OLAP 数据库实现方式有以下几种：</p>
<ol>
<li>数据检索引擎，如 ES。可存储结构化/非结构化数据，同时具备明细查询和聚合查询能力，但其索引类型并不是针对聚合分析设计的，所以聚合查询方面开销较大，其次，ES 不但要保存所有原始数据，还需要生成较多索引，所以存储空间开销会更大，数据写入效率较 Druid 会差一些。相比较，Druid 只能处理结构化数据（预定义 Schema），由于进行预聚合，所以 Druid 抛弃了原始数据，导致其缺少原始明细查询能力，若关闭预聚合，又会丧失 Druid 的优势。</li>
<li>预计算+KV 存储实现，如 Kylin。缺点是需在预处理中处理预设的聚合逻辑，故损失了查询灵活性，且面临数据过于膨胀的情况。</li>
<li>SQL on Hadoop 引擎：如 Presto，SparkSQL</li>
</ol>
<h3 id="能力对比">能力对比</h3>
<table>
<thead>
<tr>
<th></th>
<th>Kylin</th>
<th>ES</th>
<th>SparkSQL</th>
<th>Druid</th>
<th>Presto</th>
<th>Impala</th>
</tr>
</thead>
<tbody>
<tr>
<td>离线查询</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>实时查询</td>
<td><font color="blur">N</font></td>
<td>Y</td>
<td><font color="blur">N</font></td>
<td>Y</td>
<td><font color="blur">N</font></td>
<td><font color="blur">N</font></td>
</tr>
<tr>
<td>丰富的 SQL</td>
<td>Y</td>
<td><font color="blur">N</font></td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>百亿数据集</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>聚合亚秒级响应</td>
<td>Y</td>
<td><font color="blur">N</font></td>
<td><font color="blur">N</font></td>
<td>Y</td>
<td><font color="blur">N</font></td>
<td><font color="blur">N</font></td>
</tr>
<tr>
<td>精准去重</td>
<td>Y</td>
<td><font color="blur">N</font></td>
<td>Y</td>
<td><font color="blur">N</font></td>
<td>Y</td>
<td>Y</td>
</tr>
<tr>
<td>表关联</td>
<td>Y（弱）</td>
<td><font color="blur">N</font></td>
<td>Y</td>
<td><font color="blur">N</font></td>
<td>Y</td>
<td>Y</td>
</tr>
</tbody>
</table>
<blockquote>
<p>相较于 Kylin，Druid 没有模型管理和 cube 管理能力，Kylin 无法提供实时查询</p>
<p>相较 ES，Druid 优势在于聚合计算，ES 优势在于查询明细</p>
</blockquote>
<h2 id="性能特性比较">性能特性比较</h2>
<h3 id="简单查询">简单查询</h3>
<p>在简单查询场景（命中索引或物化视图-预聚合数据），这样的查询通常出现在「在线数据服务」的企业应用，并发查询量大，对响应时间要求一般是 ms 级别，最合适的是 ES，doris，druid，kylin 这些</p>
<blockquote>
<ul>
<li>druid、kylin的 QPS &lt;1000</li>
<li>Clickhouse的 QPS &lt; 100</li>
<li>ElasticSearch QPS &gt; 1000</li>
<li>在亚秒级别响应的只有 es，druid，kylin，clickhouse。Hive 在落在分钟小时级，其它在秒级。</li>
</ul>
</blockquote>
<pre class="mermaid">quadrantChart
	title 简单查询吞吐能力
	x-axis "毫秒" --> "分钟小时"
	y-axis "几十" --> "几千"
	quadrant-1 "高QPS高时延"
	quadrant-2 "高QPS低时延"
	quadrant-3 "低QPS低时延"
	quadrant-4 "低QPS高时延"
  Druid:[0.3,0.6]
  Kylin:[0.3,0.55]
  ElasticSearch:[0.2,0.85]
  Clickhouse:[0.32,0.2]
  Impala+kudu:[0.42,0.57]
  Presto:[0.42,0.52]
  FlinkSQL:[0.45,0.32]
  SparkSQL:[0.45,0.21]
  Hive:[0.75,0.3]</pre>
<h3 id="复杂查询">复杂查询</h3>
<p>复杂查询场景，指复杂聚合查询，大批量数据 scan，在 ad-hoc 场景中，往往用户不能预先知道要查什么，更多是探索式的。</p>
<pre class="mermaid">quadrantChart
	title 复杂查询吞吐能力
	x-axis "毫秒" --> "分钟小时"
	y-axis "几十" --> "几千"
	quadrant-1 "高QPS高时延"
	quadrant-2 "高QPS低时延"
	quadrant-3 "低QPS低时延"
	quadrant-4 "低QPS高时延"
  Druid:[0.65,0.30]
  Kylin:[0.65,0.25]
  ElasticSearch:[0.65,0.35]
  Clickhouse:[0.48,0.2]
  Impala+kudu:[0.42,0.57]
  Presto:[0.42,0.52]
  FlinkSQL:[0.75,0.19]
  SparkSQL:[0.75,0.14]
  Hive:[0.9,0.21]</pre>
<h3 id="ES-出列单看">ES 出列单看</h3>
<p>ES，Druid，Kylin 都是单轮的 MapReduce，中间结果结果存储在内存中，通过网络直接交换，而不是像典型的 多轮MR 每次 shuffle 要先落盘。</p>
<p>用 ES 做 OLAP 引擎，有几项优势：</p>
<ul>
<li>查询模式简单的场景高 QPS，低延迟，过滤条件多。ES 底层依赖 Lucene文件格式，可把 Lucene 理解为一种行列混存的模式，在查询时通过 FST，跳表加快数据查询。
<ul>
<li>但单轮的 MR模式（单节点汇聚）若 Reduce 数据量较大（数据量较大或进行扫描聚合类查询时），由于 ES 是单节点执行，可能会非常慢。</li>
</ul>
</li>
<li>集群自动化管理能力非常强（shard allocation，recovery），集群，索引管理和查看 API 非常丰富。</li>
</ul>
<h2 id="多记一嘴-Druid">多记一嘴 Druid</h2>
<p>很多数据仓库产品都是以『批处理』为基础，这导致记录指标时的时间与进行分析时的时间间出现延迟。</p>
<ul>
<li>
<p>指标是衡量事物发展程度的单位和方法，通常需要经过加和、平均等聚合统计才能得到。如 PV，UV，页面停留时长，用户获取成本</p>
</li>
<li>
<p>维度是事务现象的某种特征，如性别、地区，时间，版本，操作系统都是维度。Druid 只会预计算<strong>最细粒度</strong>的维度和时间结果，减少维度爆炸问题，是一种比较平衡的方式。</p>
</li>
</ul>
<p>Druid 之所以能在 OLAP 家族中占一席之地，除了依赖 MPP 架构外，还运用了四点重要的技术</p>
<ol>
<li>预聚合：减少数据存储于避免查询时不必要的计算</li>
<li>列式存储</li>
<li>字典编码：有效提升数据压缩率</li>
<li>位图索引：让很多查询转化成计算机层面的位计算，提升效率</li>
</ol>
<p>存储层是 Druid 的核心组件，用于存储和管理数据，其用列式存储格式来优化查询性能和压缩数据大小，存储层由多个数据分片组成，每个分片都包含了特定时间范围内的数据，数据分片可水平扩展和复制，以实现高可用性和高吞吐量。</p>
<p>使用 Druid 过程中，维度不要太多，维度数据导入将十分耗时。磁盘适用固态盘，这样你的查询速度才稳定的快。</p>
<h3 id="时序数据库特性">时序数据库特性</h3>
<p>Druid 是针对时间序列数据提供的低延时数据写入及快速交互式查询的分布式 OLAP 数据库。时间列是 Druid 数据模型的核心组成部分，它允许数据按时间进行排序，分割和分片存储，以支持高效的数据查询，且可将数据按固定时间间隔（小时，天，周）划分为不同的桶，每个桶存储一个时间段内的数据。其与典型的InfluxDB、OpenTSDB部分特性类似，这些时序数据库具备一些共同特点</p>
<ul>
<li>一是通过内存增量所有让数据写入即可查</li>
<li>二是下采样或 RDD操作减少数据量，Druid 在数据写入时就会对数据预聚合，进而减少原始数据量。</li>
<li>三是可能会支持 SchemaLess，InfluxDB中，用户可任意加 tag，InfluxDB 可对新增 tag 进行聚合查询，但 Druid 在这点上跟 InfluxDB 略有差异，Druid 需预定义 Schema，Schema 数据打包在最后形成的数据文件中，也就是说过去和未来数据的 Schema 可以不同，不同 Schema 的数据可共存，固然 Druid 不是 Schemaless 的，但调整也是比较灵活的</li>
</ul>
<p>在时序数据上，ES 也有类似功能，提供了全文检索的模式，并提供访问原始事件级数据，也提供了分析和汇总支持，但根据研究，<strong>ES 在数据获取和聚集上资源消耗比在 Druid 高，Druid 侧重于 OLAP 工作流程，以较低的成本设计了聚集和获取的高性能方案（亿级百列数据查询时间是 mysql cluster 的1/100~1/10）</strong>，提供了结构化事件数据的一些基本的搜索支持，更偏重于数据汇总分析。</p>
<p>为了性能，你开启了预聚合 rollup，这会带来信息量的丢失，因为 roll-up 的粒度会变成最小的数据可视化粒度。如果以分钟粒度进行 roll-up，那么入库后能查看的数据最小粒度即为分钟级别。</p>
<h3 id="Segment设计">Segment设计</h3>
<p>Segment 是 Druid 的一个关键抽象，是一种不可变（但有版本控制）数据结构。<font color="tomato">Druid 可看作是 Lambda 的第一个实现</font>。</p>
<p>Segment 的不可修改性简化了 Druid 的实现，但若你有修改数据的需求，重创建 Segment的 Bitmap indexing 过程是比较耗时的。其能接受的数据结构相对简单，不能处理嵌套结构的数据。</p>
<p>Druid 用 Lambda 架构分别处理实时数据和批量数据。数据存储在 Datasource 中，类似 RDBMS 中的 Table，每个 Datasource 中按时间划分，每个时间范围称为一个 Chunk（一般一天一个 Chunk），在一个 Chunk 中数据根据维度的Hash 或范围分成一个或多个Segment，每个 Segment 都是一个单独文件，通常含几百万行数据，这些Segment 是按时间组织的，所以在按时间查询时，效率非常高。</p>
<blockquote>
<p>实际上，Datasource 和 Chunk 都是抽象的，Druid 底层存储就是 Segment，一个 Segment 生成后就无法被修改，只能通过生成一个新 Segment 来替代旧的。Segment 的命名规则可帮助快速找到需要查的 Segment 文件。不同列的数据都单独保存一个文件的话，会产生很多小文件，严重影响文件系统读写性能，因此每个字段数据生成好后，会以二进制拼接的方式合成一个文件以提升性能，在逻辑上，不同列的数据存储是分开的。</p>
</blockquote>
<p>在数据摄取准备时，要敲定查询的最小粒度，如 hour，查询最小粒度要&lt;= Segment 分块文件粒度</p>
<p>Druid 使用 Segment 时会以多级缓存的方式使用，除了可靠存储，还会在内存中及服务器硬盘上加载 Segment 作为缓存。开启预聚合（rollup）特性的 Segment内部也会不一样，可大幅减少数据存储量，提升查询效率，关闭 rollup 则 Segment 中会保留写入的原始数据。</p>
<p><u>让 Druid 在繁重的查询压力下保持良好的操作性能，应让 segment 文件大小在 300mb 至 700mb 之间</u>。其在设计之初，为了追求亚秒级的 OLAP 能力，对精准去重计算，不支持，只提供近似查询。在实时要求程度不高的情况下，可通过时间换空间的方式，对需要计算的字段做 group by 查询，然后 count(1)实现精确去重，</p>
<h3 id="行数据结构剖析">行数据结构剖析</h3>
<p>Druid 中每一行包含 3 部分：时间戳，维度和指标。</p>
<ul>
<li>时间戳就是该条数据产生或保存的时间，主要作用有划分 Segment，按照某种时间粒度预聚合数据等。</li>
<li>指标就是一些整数或浮点数值，也可能是复杂数据结构如 HyperUnique，用来在查询时聚合得到结果。</li>
<li>维度相对复杂点，因为在查询时要支持 filter，group by 操作，每列维度值会保存 3 个数据结构来记录（如10 行数据，某列数值取值如下)</li>
</ul>
<p>$$<br>
\begin{bmatrix}<br>
A\<br>
A\<br>
B \<br>
C \<br>
B \<br>
C \<br>
D \<br>
C \<br>
D \<br>
D \<br>
\end{bmatrix}<br>
$$</p>
<ol>
<li>取值字典：每个值映射为一个 ID，可理解为独热编码表</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">&quot;A&quot;</span><span class="punctuation">:</span><span class="number">0</span></span><br><span class="line"><span class="attr">&quot;B&quot;</span><span class="punctuation">:</span><span class="number">1</span></span><br><span class="line"><span class="attr">&quot;C&quot;</span><span class="punctuation">:</span><span class="number">2</span></span><br><span class="line"><span class="attr">&quot;D&quot;</span><span class="punctuation">:</span><span class="number">3</span></span><br></pre></td></tr></table></figure>
<ol start="2">
<li>10 行/每一行取值的 ID：行数据的独热编码表示。用于支持 group by 和 TopN 查询。</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">2</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">,</span><span class="number">3</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<ol start="3">
<li>每个取值对应的 Bitmap（对 AND 和 OR 操作速度非常快），在 Segment 存储中会以 concise/roaring 方式压缩。独热码表值在此列的位置分布。</li>
</ol>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">]</span></span><br><span class="line"><span class="number">1</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">]</span></span><br><span class="line"><span class="number">2</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">]</span></span><br><span class="line"><span class="number">3</span><span class="punctuation">:</span><span class="punctuation">[</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">0</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">,</span><span class="number">1</span><span class="punctuation">]</span></span><br></pre></td></tr></table></figure>
<h3 id="位图索引再举例">位图索引再举例</h3>
<p>举一个更直观的例子，如下表数据</p>
<table>
<thead>
<tr>
<th>时间戳</th>
<th>维度列</th>
<th></th>
<th>指标列</th>
</tr>
</thead>
<tbody>
<tr>
<td>dt</td>
<td>loc</td>
<td>item</td>
<td>amount</td>
</tr>
<tr>
<td>2022-01-01</td>
<td>北京</td>
<td>书</td>
<td>100</td>
</tr>
<tr>
<td>2022-01-01</td>
<td>北京</td>
<td>电脑</td>
<td>200</td>
</tr>
<tr>
<td>2022-01-01</td>
<td>上海</td>
<td>电脑</td>
<td>300</td>
</tr>
<tr>
<td>2022-01-01</td>
<td>广州</td>
<td>手机</td>
<td>400</td>
</tr>
<tr>
<td>2022-01-01</td>
<td>杭州</td>
<td>水果</td>
<td>500</td>
</tr>
<tr>
<td>2022-01-01</td>
<td>北京</td>
<td>书</td>
<td>600</td>
</tr>
</tbody>
</table>
<p>Druid 将如上数据结构构建位图索引，来实现快速查找</p>
<table>
<thead>
<tr>
<th>原始值</th>
<th>列值编码</th>
<th>Bit</th>
<th>m</th>
<th>a</th>
<th>p</th>
<th>位</th>
<th>图</th>
</tr>
</thead>
<tbody>
<tr>
<td>北京</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>上海</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>广州</td>
<td>2</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td></td>
<td>0</td>
</tr>
<tr>
<td>杭州</td>
<td>3</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
<tr>
<td>书籍</td>
<td>4</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
</tr>
<tr>
<td>电脑</td>
<td>5</td>
<td>0</td>
<td>1</td>
<td>1</td>
<td>0</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>手机</td>
<td>6</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
<td>0</td>
</tr>
<tr>
<td>水果</td>
<td>7</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>0</td>
<td>1</td>
<td>0</td>
</tr>
</tbody>
</table>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> <span class="built_in">sum</span>(amount) <span class="keyword">as</span> totalamout <span class="keyword">from</span> <span class="keyword">table</span> <span class="keyword">where</span> loc<span class="operator">=</span>&quot;北京&quot; <span class="keyword">and</span> &quot;item&quot;<span class="operator">=</span>&quot;电脑&quot;</span><br></pre></td></tr></table></figure>
<p>那么根据位图，查询条件就是（110001）&amp; （011000）= (010000)所标 1的行，也就是第 2 行。</p>
<h3 id="设计讨论">设计讨论</h3>
<h4 id="Druid-vs-Impala">Druid vs Impala</h4>
<p>Druid 和 Impala 的比较基本可归结为需要设计什么样的系统。</p>
<ul>
<li>
<p>Druid 被设计为一直在线的服务（所以其容灾，扩容再平衡都做得很完备, 各种nodes挂掉都不会使得 Druid 停止工作，但状态会无法更新），可获取实时数据。在查询速度方面，Druid 是列存储方式，数据经过压缩加入到索引结构中，&quot;压缩&quot;增加了 RAM 中数据存储能力，能使 RAM 适应更多的数据快速存储。支持时间序列和 group by 样式的查询，但不支持 join。</p>
</li>
<li>
<p>Impala 可认为是 HDFS 之上的后台程序缓存层。Impala 基于 HDFS 或其它后备存储，限制了数据获取的速度。支持 SQL 样式的查询。</p>
</li>
</ul>
<h4 id="Druid-vs-Kylin">Druid vs Kylin</h4>
<p>Druid 是 OLAP 计算+存储二者一肩挑设计，Kylin 是一个离线预处理框架，依赖 Spark 和 YARN 做计算，然后用 Hbase 保存预处理结果，而后进行展示。它们二者都对 HDFS 有依赖，Druid 只把 HDFS 当做远程离线存储，但实际计算过程并不使用。而 Kylin使用的是 Hadoop 技术栈，中间计算过程和最后计算结果里面都会用到 HDFS。</p>
<p>Druid 有灵活的预聚合能力，可利用 HyperLogLog 算法做多维的 UV 聚合，而 Kylin 则是使用强大的位图计算，做了精确的 UV 计算能力。</p>
<h1>新的Topic与期待</h1>
<h2 id="全频谱可平衡支持">全频谱可平衡支持</h2>
<p>新一代数据平台系统需要形成一个从离线到实时的全频谱计算能力，在</p>
<ul>
<li>Data Freshness</li>
<li>Resource Costs</li>
<li>Query Performance</li>
</ul>
<p>的不可能三角里给用户提供多种不同平衡的选择。面向未来的系统，应能做到<strong>一套系统一套资源，针对上述三个方向的不同平衡点，为用户提供多种选项</strong>，实现从离线到实时的全频谱。</p>
<h2 id="数据网格">数据网格</h2>
<p>Data Mesh 是一种数据管理方法，强调数据的分布式架构和以业务领域为中心的数据所有权和治理权，促进数据的可访问性和质量。从侧面也反映了以中央IT团队来管理数据搞不好。</p>
<ul>
<li>数据量过大或中央数据管理人员对数据不够了解，那么数据湖可能无法确保数据质量。数据网格架构的基础理念是将数据视作有价值的产品，那么数据的质量和完整性就成为数据管理的重点。</li>
<li>将企业内特定数据集的所有权和职责，分散至具备专业知识的用户（能深入了解并充分利用这些数据），同时通过标准化和自动化来保证整体的一致性和互操作性，发挥数据的价值。</li>
<li>另外数据湖的集中式架构，数据检索流程和程序一直较复杂，很容易出现瓶颈，大量整合数据的管控工作全压到了一个 IT 团队肩上，随着这些数据量和数据检索需求的增加，这些IT 团队会不堪重负，合规任务也可能会被仓促了事，引入潜在的风险和损失。</li>
</ul>
<pre class="mermaid">stateDiagram-v2
		state1:面向领域的所有权
		state2:数据即产品
		state3:自助式数据平台
		state4:联邦计算治理
    state1 --> state2:防止数据孤岛
    state1 --> state3:赋能领域团队
    state1 --> state4:增加参与度，减少领域孤立
    state2 --> state3:降低所有权成本
    state2 --> state4:通过互连数据产品获得更高阶价值
    state4 --> state3:网格级别一致可靠的策略执行
    note left of state2 : 产品思维应用于数据管理：可发现、可理解、可信赖
    note left of state3
    支持去中心化数据管理
    简化数据产品创建和使用过程
    end note
    note right of state4
    通过自动化和计算实现政策执行
    平衡域自主性和全局互操作性
    end note</pre>
<h2 id="数据安全">数据安全</h2>
<p>数据本身已经成为一种资产，有非常好的资产变现和产生额外价值的能力和需求。同时，数据很可能涉及隐私泄露，这就形成了有关数据安全，隐私保护和数据共享的矛盾。<font color="dodgerblue">在隐私和安全的情况下做到更好的数据共享和变现成了新热点</font>。</p>
<p>数据安全不仅仅是一个权限问题，还涉及很复杂的系统架构，包括<u>权限管理，用户隔离，存储加密，异地备份，敏感数据/风险行为的识别</u>。</p>
<p>安全共享这个方向包括两个核心场景：一方数据对外共享，多方数据共同计算。第二点是多方的数据交叉计算或者叫联邦计算。这里面包含两项核心技术，一个是基于隐私计算的数据交互，一个是基于联邦学习的数据交互。不论是一方域内多租的安全模式，还是跨域多方的安全共享模式，目前都是领域热点。</p>
<h2 id="IOT-时代的不同">IOT 时代的不同</h2>
<p>目前的大数据系统处理的数据主要是人的行为日志，如浏览记录，手机上对App的点击操作等，都会以日志形式传到系统中，反馈给推荐系统，广告系统。</p>
<p>后续接入网络的硬件设备的数据慢慢会超过人的数量，IOT数据处理也会成为一个热点。但大多数时候设备数据并没有太多意义和价值，只有出问题的时候数据才会产生波动，这种情况下<strong>如何有效收集设备产生的数据，海量数据无法全量上云，需要在端侧做一定处理，就成了新的需求，也就是端云协同，是IOT的特点</strong>，不过也实在没什么新鲜，没有技术难度。</p>
<h2 id="DW-Automation">DW Automation</h2>
<ul>
<li>国内最大的互联网公司，内部数据量均在EB级别，作业量每天百万级别以上。</li>
<li>主流客户其实都在PB级的数据规模，有些在百PB级别。</li>
</ul>
<p>面对这么大的数据规模，传统DBA以人为轴来开展数据管理和优化的方式不再胜任。这种复杂的数据组织和优化需更多的基于AI的自动化技术来完成。如通过机器学习自动进行数据分层，依据访问的统计判断什么样的数据更重要，那些作业可放在冷存储上。</p>
<h2 id="几朵乌云">几朵乌云</h2>
<ol>
<li>计算引擎的多样化，最终能否诞生一套onesize4all的引擎满足多样的计算需求，兼顾通用性和效率</li>
</ol>
<blockquote>
<p>现在大家几乎还是通过拼接不同引擎来搭建自己的计算平台，如Spark做批处理，Flink做流处理，Clickhouse做交互分析，再复杂点，可能还要部署Hbase做KV查询，用ES做文本检索。虽每个单独产品已比较成熟，但整个系统复杂度非常高，这里面就蕴含着标题的期待。</p>
</blockquote>
<ol start="2">
<li>基于开源自建还是选购企业级产品</li>
</ol>
<blockquote>
<p>开源软件免费，但需要独立的团队去支撑这一大数据平台的部署和运维，带来相对较高的维护成本（一个简答的公式是：对于百台规模的平台，基于开源软件自建的总TCO=物理硬件成本+开发维护人力成本=物理硬件成本*2）。</p>
<p>头部的技术公司，规模较大，人力边际成本低。<font color="tomato">非头部企业直接购买SAAS化企业级平台，综合成本更低</font>，享受更好的性能，安全性，稳定性和兜底能力。当然另一面就是技术黑盒和高改造成本（需平台厂商来做）的问题。</p>
<p>Snowflake开箱即用全托管平台大受欢迎，Databricks以开源生态为主线也形成广泛客户群体。组装还是直接买笔记本，答案在客户手中。</p>
</blockquote>
<ol start="3">
<li>关系模型外，是否会发展处其它主流计算范式</li>
</ol>
<blockquote>
<p>数据库数仓已发展40+年，主流计算范式就是二维关系表达，近10年，深度学习带来新的计算方式，有没有更新一代会产生？</p>
<p>图计算当前最被看好（点边模型）。但数据库技术发展过程中也诞生了图计算模式，且发展多年，但目前仍不是主流，但随着图学习(graphembedding)的兴起，是否会焕发新生，值得期待。</p>
</blockquote>
<h2 id="Other">Other</h2>
<p>大家都说软件工程师，软件产业，但需要从 Code/Program观念转变成 Data 观念，在做任何设计和开发时，要把 Data 放在第一位，这样才是 Information Technology 行业。</p>
<p><font color="dodgerblue">海量数据一直在增长，但我们应想办法控制下来，未来的趋势要考虑缩小海量数据，而不是任凭它扩张</font>。</p>
<p>太多初创企业陷入错误的逻辑：大数据=非结构化数据=hadoop，非结构化和半结构化数据的利用是呈现了爆炸式增长，但也要注意到，结构化数据的使用上，也出现了指数式增长。</p>
<p>搞起来了，自有人会来光顾。这是错误的观念，想用大数据创业，业务专长必须有，同时技术也必须保证是尖端的，这些都是普通商户所缺乏的，如何<font color="dodgerblue">帮助非技术型用户在其日常工作中轻松使用数据才是问题的关键</font>。</p>
<h1>参考</h1>
<div id="footnotes"><hr><div id="footnotelist"><ol style="list-style: none; padding-left: 0; margin-left: 40px"><li id="fn:1"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">1.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">Segmentfault <a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000018045485">简单认识 KMV Sketch 估算算法</a><a href="#fnref:1" rev="footnote"> ↩</a></span></li><li id="fn:2"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">2.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">CSDN <a target="_blank" rel="noopener" href="https://blog.csdn.net/white_light/article/details/142527456">开源 OLAP 技术架构对比</a><a href="#fnref:2" rev="footnote"> ↩</a></span></li><li id="fn:3"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">3.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">51CTO <a target="_blank" rel="noopener" href="https://blog.51cto.com/u_14637492/8964146">数据湖三剑客对比</a><a href="#fnref:3" rev="footnote"> ↩</a></span></li><li id="fn:4"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">4.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">腾讯云 <a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1626302">Druid Segment存储格式</a><a href="#fnref:4" rev="footnote"> ↩</a></span></li><li id="fn:5"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">5.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">腾讯云 <a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/1927729">解读数据架构的2021</a><a href="#fnref:5" rev="footnote"> ↩</a></span></li><li id="fn:6"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">6.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">腾讯云 <a target="_blank" rel="noopener" href="https://cloud.tencent.com/developer/article/2005918">基于 Iceberg 扩展 Doris 数据湖能力的实践</a><a href="#fnref:6" rev="footnote"> ↩</a></span></li><li id="fn:7"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">7.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">搜狐 <a target="_blank" rel="noopener" href="https://www.sohu.com/a/415708939_411876">主流开源OLAP系统的分类及核心技术点</a><a href="#fnref:7" rev="footnote"> ↩</a></span></li><li id="fn:8"><span style="display: inline-block; vertical-align: top; padding-right: 10px; margin-left: -40px">8.</span><span style="display: inline-block; vertical-align: top; margin-left: 10px;">搜狐 <a target="_blank" rel="noopener" href="https://news.sohu.com/a/601378393_374240">主流开源OLAP引擎大比拼</a><a href="#fnref:8" rev="footnote"> ↩</a></span></li></ol></div></div></article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src="https://cdn.diffday.com/picgo/diff_128.png" title="头像" alt="头像"><img class="post-copyright__author_img_front" src="https://cdn.diffday.com/picgo/diff_128.png" title="头像" alt="头像"></a><div class="post-copyright__author_name">DiffDay</div><div class="post-copyright__author_desc">We are here to be creators!</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.diffday.com/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0%E4%B8%8E%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88.html">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://blog.diffday.com/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0%E4%B8%8E%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88.html')">数据中台与技术漫谈</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"><div class="post-reward" onclick="anzhiyu.addRewardMask()"><div class="reward-button button--animated" title="赞赏作者"><i class="anzhiyufont anzhiyu-icon-hand-heart-fill"></i>打赏作者</div><div class="reward-main"><div class="reward-all"><span class="reward-title">感谢你的肯定与鼓励</span><ul class="reward-group"><li class="reward-item"><a href="http://cdn.diffday.com/picgo/wechatpay.jpg" target="_blank"><img class="post-qr-code-img" src="http://cdn.diffday.com/picgo/wechatpay.jpg" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="http://cdn.diffday.com/picgo/alipay-n.jpeg" target="_blank"><img class="post-qr-code-img" src="http://cdn.diffday.com/picgo/alipay-n.jpeg" alt="支付宝"/></a><div class="post-qr-code-desc">支付宝</div></li></ul><a class="reward-main-btn" href="/about/#about-reward" target="_blank"><div class="reward-text">赞赏者名单</div><div class="reward-dec">因为你们的支持让我意识到写文章的价值🙏</div></a></div></div></div><div id="quit-box" onclick="anzhiyu.removeRewardMask()" style="display: none"></div></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.diffday.com/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0%E4%B8%8E%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88.html"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=数据中台与技术漫谈&amp;url=https://blog.diffday.com/%E6%95%B0%E6%8D%AE%E4%B8%AD%E5%8F%B0%E4%B8%8E%E6%8A%80%E6%9C%AF%E6%BC%AB%E8%B0%88.html&amp;pic=http://cdn.diffday.com/picgo/20241023162552.png" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="rm.copyPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.diffday.com" target="_blank">Diffday</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E5%A4%A7%E6%95%B0%E6%8D%AE/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>大数据<span class="tagsPageCount">6</span></a></div></div></div><div class="post_share"><div class="social-share" data-image="http://cdn.diffday.com/picgo/20251010152354.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/%E4%BF%9D%E9%99%A9%E4%B8%9A%E7%9A%84%E7%9B%91%E7%AE%A1%E4%B8%8E%E6%94%B9%E9%9D%A9.html"><img class="prev-cover" src="http://cdn.diffday.com/picgo/20220106170319.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">保险业的监管与改革</div></div></a></div><div class="next-post pull-right"><a href="/%E5%BE%AE%E4%BF%A1%E7%89%88%E6%9C%AC%E7%9A%84%E5%8E%86%E5%8F%B2%E5%9C%B0%E5%9B%BE.html"><img class="next-cover" src="http://cdn.diffday.com/picgo/20230412190127.png" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">微信版本的历史地图</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/Yarn%E8%B5%84%E6%BA%90%E8%B0%83%E5%BA%A6%E7%AD%96%E7%95%A5.html" title="Yarn资源调度策略"><img class="cover" src="http://cdn.diffday.com/picgo/20210126151356.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-history fa-fw"></i> 2024-06-21</div><div class="title">Yarn资源调度策略</div></div></a></div><div><a href="/%E4%BA%91%E5%8E%9F%E7%94%9F%E5%9F%BA%E5%BA%A7%E4%B8%8B%E7%9A%84%E5%A4%A7%E6%95%B0%E6%8D%AE.html" title="云原生基座下的大数据"><img class="cover" src="http://cdn.diffday.com/picgo/20230809113620.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-history fa-fw"></i> 2024-06-27</div><div class="title">云原生基座下的大数据</div></div></a></div><div><a href="/%E4%BC%81%E4%B8%9A%E5%A4%A7%E6%95%B0%E6%8D%AE%E5%8E%86%E5%8F%B2%E4%B8%8E%E5%BA%94%E7%94%A8%E8%B6%8B%E5%8A%BF.html" title="企业大数据历史与应用趋势"><img class="cover" src="https://cdn.diffday.com/picgo/20210421170120.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-history fa-fw"></i> 2024-06-27</div><div class="title">企业大数据历史与应用趋势</div></div></a></div><div><a href="/%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%94%B6%E9%9B%86%E5%A4%84%E7%90%86%E5%B7%A5%E5%85%B7%E9%93%BE.html" title="大数据收集处理工具链简介"><img class="cover" src="http://cdn.diffday.com/picgo/20240829105817.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-history fa-fw"></i> 2024-08-29</div><div class="title">大数据收集处理工具链简介</div></div></a></div><div><a href="/%E6%95%B0%E6%8D%AE%E5%80%BE%E6%96%9C%E6%B5%85%E8%BF%B0.html" title="数据倾斜浅述"><img class="cover" src="http://cdn.diffday.com/picgo/20221109111839.png" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-history fa-fw"></i> 2024-08-26</div><div class="title">数据倾斜浅述</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div></div><div class="comment-wrap"><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">数据中台</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E6%A0%87"><span class="toc-number">1.1.</span> <span class="toc-text">目标</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%B7%E5%80%BC%E9%94%9A%E5%AE%9A"><span class="toc-number">1.1.1.</span> <span class="toc-text">价值锚定</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B7%A5%E4%BD%9C%E8%8C%83%E7%95%B4"><span class="toc-number">1.2.</span> <span class="toc-text">工作范畴</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%83%BD%E5%8A%9B%E5%BB%BA%E8%AE%BE"><span class="toc-number">1.3.</span> <span class="toc-text">能力建设</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E6%B2%BB%E7%90%86%E6%80%8E%E4%B9%88%E5%BC%BA%E8%B0%83%E9%83%BD%E4%B8%8D%E4%B8%BA%E8%BF%87"><span class="toc-number">1.4.</span> <span class="toc-text">数据治理怎么强调都不为过</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%97%E6%B3%95%E5%BB%BA%E6%A8%A1%E7%AE%A1%E7%90%86"><span class="toc-number">1.4.1.</span> <span class="toc-text">算法建模管理</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%A2%E9%98%9F%E5%88%92%E5%88%86"><span class="toc-number">1.5.</span> <span class="toc-text">团队划分</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E5%AD%97%E5%8C%96%E8%BD%AC%E5%9E%8B%EF%BC%8C%E5%BF%90%E5%BF%91%E8%89%B0%E8%8B%A6"><span class="toc-number">1.6.</span> <span class="toc-text">数字化转型，忐忑艰苦</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%8C%87%E5%AF%BC%E6%80%9D%E6%83%B3"><span class="toc-number">1.6.1.</span> <span class="toc-text">指导思想</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93%E4%B8%8E%E4%BE%8B%E8%AF%B4"><span class="toc-number">1.6.2.</span> <span class="toc-text">总结与例说</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%BF%87%E5%8E%BB%E7%9A%84%E5%80%BA%E5%8A%A1"><span class="toc-number">1.7.</span> <span class="toc-text">过去的债务</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">古早技术概念介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E4%BB%93%E7%9A%84%E6%98%9F%E5%9E%8B%E5%92%8C%E9%9B%AA%E8%8A%B1%E6%A8%A1%E5%9E%8B%EF%BC%88%E5%A4%9A%E8%A1%A8%E7%BB%84%E5%90%88%E6%A8%A1%E5%9E%8B%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">数仓的星型和雪花模型（多表组合模型）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%BD%E8%A1%A8%E6%A8%A1%E5%9E%8B%E5%92%8C%E5%A4%9A%E8%A1%A8%E7%BB%84%E5%90%88%E6%A8%A1%E5%9E%8B"><span class="toc-number">2.2.</span> <span class="toc-text">宽表模型和多表组合模型</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9F%BA%E6%95%B0%E4%BC%B0%E8%AE%A1"><span class="toc-number">2.3.</span> <span class="toc-text">基数估计</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OLTP-vs-OLAP"><span class="toc-number">2.4.</span> <span class="toc-text">OLTP vs OLAP</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#OLAP-%E8%84%91%E5%9B%BE"><span class="toc-number">2.4.1.</span> <span class="toc-text">OLAP 脑图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B9%B6%E5%8F%91%E5%B7%AE%E5%BC%82"><span class="toc-number">2.4.2.</span> <span class="toc-text">并发差异</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Hadoop%E7%9A%84%E8%B0%83%E5%BA%A6%E6%BC%94%E8%BF%9B"><span class="toc-number">2.5.</span> <span class="toc-text">Hadoop的调度演进</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%A7%E6%95%B0%E6%8D%AE%E6%9E%B6%E6%9E%84"><span class="toc-number">2.6.</span> <span class="toc-text">大数据架构</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Lambda-%E6%9E%B6%E6%9E%84"><span class="toc-number">2.6.1.</span> <span class="toc-text">Lambda 架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kappa-%E6%9E%B6%E6%9E%84"><span class="toc-number">2.6.2.</span> <span class="toc-text">Kappa 架构</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">湖仓一体化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E6%97%B6%E6%95%B0%E4%BB%93"><span class="toc-number">3.1.</span> <span class="toc-text">实时数仓</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%89%E5%A4%A7%E5%BD%93%E7%BA%A2%E5%9B%BD%E9%99%85%E6%B4%BE"><span class="toc-number">3.1.1.</span> <span class="toc-text">三大当红国际派</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%9A%E8%AE%B0%E4%B8%80%E5%98%B4-Hudi"><span class="toc-number">3.1.2.</span> <span class="toc-text">多记一嘴 Hudi</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Doris"><span class="toc-number">3.1.3.</span> <span class="toc-text">Doris</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Kudu"><span class="toc-number">3.1.4.</span> <span class="toc-text">Kudu</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%80%BB%E7%BB%93"><span class="toc-number">3.1.5.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B9%96%E4%BB%93%E5%AF%B9%E6%AF%94"><span class="toc-number">3.2.</span> <span class="toc-text">湖仓对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%9E%8D%E5%90%88%E6%B5%81%E6%B4%BE%EF%BC%88Data-Lakehouse%EF%BC%89"><span class="toc-number">3.3.</span> <span class="toc-text">融合流派（Data Lakehouse）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%A4%8D%E6%9D%82%E6%80%A7%E4%B8%8E%E7%AE%A1%E7%90%86%E6%8C%91%E6%88%98"><span class="toc-number">3.3.1.</span> <span class="toc-text">数据复杂性与管理挑战</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%93%E7%B3%BB%E8%9E%8D%E5%90%88"><span class="toc-number">3.3.2.</span> <span class="toc-text">体系融合</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%BB%E7%BB%93-vs-%E9%A2%84%E6%B5%8B"><span class="toc-number">3.4.</span> <span class="toc-text">总结 vs 预测</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">OLAP 查询引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8F%A4%E6%97%A9%E5%AE%9E%E6%97%B6%E6%95%B0%E6%8D%AE%E6%8E%A2%E7%B4%A2%E7%B3%BB%E7%BB%9F%E7%9A%84%E9%97%AE%E9%A2%98"><span class="toc-number">4.1.</span> <span class="toc-text">古早实时数据探索系统的问题</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%96%B0%E8%B4%A8%E7%94%9F%E4%BA%A7%E5%8A%9B%E5%AF%B9%E6%AF%94"><span class="toc-number">4.2.</span> <span class="toc-text">新质生产力对比</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BB%86%E8%AF%B4%E8%AF%B4%E4%B8%80%E4%BC%97%E5%BC%95%E6%93%8E"><span class="toc-number">4.3.</span> <span class="toc-text">细说说一众引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Presto"><span class="toc-number">4.3.1.</span> <span class="toc-text">Presto</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Impala"><span class="toc-number">4.3.2.</span> <span class="toc-text">Impala</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ClickHouse"><span class="toc-number">4.3.3.</span> <span class="toc-text">ClickHouse</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Greenplum"><span class="toc-number">4.3.4.</span> <span class="toc-text">Greenplum</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BC%98%E5%8A%BF"><span class="toc-number">4.3.4.1.</span> <span class="toc-text">优势</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%8A%A3%E5%8A%BF"><span class="toc-number">4.3.4.2.</span> <span class="toc-text">劣势</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Druid"><span class="toc-number">4.3.5.</span> <span class="toc-text">Druid</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%B8%8D%E9%80%82%E5%90%88%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="toc-number">4.3.5.1.</span> <span class="toc-text">不适合的场景</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#OLAP-%E7%9A%84%E5%AE%9E%E7%8E%B0%E6%A8%A1%E5%BC%8F"><span class="toc-number">4.4.</span> <span class="toc-text">OLAP 的实现模式</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%83%BD%E5%8A%9B%E5%AF%B9%E6%AF%94"><span class="toc-number">4.4.1.</span> <span class="toc-text">能力对比</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%80%A7%E8%83%BD%E7%89%B9%E6%80%A7%E6%AF%94%E8%BE%83"><span class="toc-number">4.5.</span> <span class="toc-text">性能特性比较</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.5.1.</span> <span class="toc-text">简单查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%A4%8D%E6%9D%82%E6%9F%A5%E8%AF%A2"><span class="toc-number">4.5.2.</span> <span class="toc-text">复杂查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ES-%E5%87%BA%E5%88%97%E5%8D%95%E7%9C%8B"><span class="toc-number">4.5.3.</span> <span class="toc-text">ES 出列单看</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E8%AE%B0%E4%B8%80%E5%98%B4-Druid"><span class="toc-number">4.6.</span> <span class="toc-text">多记一嘴 Druid</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%97%B6%E5%BA%8F%E6%95%B0%E6%8D%AE%E5%BA%93%E7%89%B9%E6%80%A7"><span class="toc-number">4.6.1.</span> <span class="toc-text">时序数据库特性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Segment%E8%AE%BE%E8%AE%A1"><span class="toc-number">4.6.2.</span> <span class="toc-text">Segment设计</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%A1%8C%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%89%96%E6%9E%90"><span class="toc-number">4.6.3.</span> <span class="toc-text">行数据结构剖析</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%8D%E5%9B%BE%E7%B4%A2%E5%BC%95%E5%86%8D%E4%B8%BE%E4%BE%8B"><span class="toc-number">4.6.4.</span> <span class="toc-text">位图索引再举例</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E8%AE%A8%E8%AE%BA"><span class="toc-number">4.6.5.</span> <span class="toc-text">设计讨论</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Druid-vs-Impala"><span class="toc-number">4.6.5.1.</span> <span class="toc-text">Druid vs Impala</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Druid-vs-Kylin"><span class="toc-number">4.6.5.2.</span> <span class="toc-text">Druid vs Kylin</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">新的Topic与期待</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%A8%E9%A2%91%E8%B0%B1%E5%8F%AF%E5%B9%B3%E8%A1%A1%E6%94%AF%E6%8C%81"><span class="toc-number">5.1.</span> <span class="toc-text">全频谱可平衡支持</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BD%91%E6%A0%BC"><span class="toc-number">5.2.</span> <span class="toc-text">数据网格</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E5%AE%89%E5%85%A8"><span class="toc-number">5.3.</span> <span class="toc-text">数据安全</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#IOT-%E6%97%B6%E4%BB%A3%E7%9A%84%E4%B8%8D%E5%90%8C"><span class="toc-number">5.4.</span> <span class="toc-text">IOT 时代的不同</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#DW-Automation"><span class="toc-number">5.5.</span> <span class="toc-text">DW Automation</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%87%A0%E6%9C%B5%E4%B9%8C%E4%BA%91"><span class="toc-number">5.6.</span> <span class="toc-text">几朵乌云</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Other"><span class="toc-number">5.7.</span> <span class="toc-text">Other</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">参考</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/%E6%99%BA%E8%83%BD%E9%A9%BE%E9%A9%B6%E7%9A%84%E4%B8%AD%E5%9B%BD%E6%95%85%E4%BA%8B.html" title="智能驾驶的中国故事"><img src="http://cdn.diffday.com/picgo/20241010095826.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="智能驾驶的中国故事"/></a><div class="content"><a class="title" href="/%E6%99%BA%E8%83%BD%E9%A9%BE%E9%A9%B6%E7%9A%84%E4%B8%AD%E5%9B%BD%E6%95%85%E4%BA%8B.html" title="智能驾驶的中国故事">智能驾驶的中国故事</a><time datetime="2025-10-12T11:55:11.000Z" title="更新于 2025-10-12 19:55:11">2025-10-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E7%AD%89%E4%BF%9D%E5%88%86%E7%BA%A7.html" title="信息系统安全等级保护"><img src="http://cdn.diffday.com/picgo/20251010152354.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="信息系统安全等级保护"/></a><div class="content"><a class="title" href="/%E7%AD%89%E4%BF%9D%E5%88%86%E7%BA%A7.html" title="信息系统安全等级保护">信息系统安全等级保护</a><time datetime="2025-10-11T10:27:30.000Z" title="更新于 2025-10-11 18:27:30">2025-10-11</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E5%8A%9E%E5%85%ACAI%E7%94%9F%E4%BA%A7%E5%8A%9B%E5%B7%A5%E5%85%B7.html" title="办公AI生产力工具"><img src="http://cdn.diffday.com/picgo/20251009163229.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="办公AI生产力工具"/></a><div class="content"><a class="title" href="/%E5%8A%9E%E5%85%ACAI%E7%94%9F%E4%BA%A7%E5%8A%9B%E5%B7%A5%E5%85%B7.html" title="办公AI生产力工具">办公AI生产力工具</a><time datetime="2025-10-09T08:37:18.000Z" title="更新于 2025-10-09 16:37:18">2025-10-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E5%92%8C%E7%94%B0%E7%8E%89%E7%9A%84%E4%B8%8B%E6%B2%89%E6%BC%94%E5%8F%98.html" title="和田玉的下沉演变"><img src="http://cdn.diffday.com/picgo/20250716132428.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="和田玉的下沉演变"/></a><div class="content"><a class="title" href="/%E5%92%8C%E7%94%B0%E7%8E%89%E7%9A%84%E4%B8%8B%E6%B2%89%E6%BC%94%E5%8F%98.html" title="和田玉的下沉演变">和田玉的下沉演变</a><time datetime="2025-10-09T08:35:29.000Z" title="更新于 2025-10-09 16:35:29">2025-10-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E6%99%92%E7%A5%9E%E5%85%BD=%E6%99%92%E8%87%AA%E5%B7%B1.html" title="晒神兽=晒自己"><img src="http://cdn.diffday.com/picgo/20250918182147.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="晒神兽=晒自己"/></a><div class="content"><a class="title" href="/%E6%99%92%E7%A5%9E%E5%85%BD=%E6%99%92%E8%87%AA%E5%B7%B1.html" title="晒神兽=晒自己">晒神兽=晒自己</a><time datetime="2025-10-09T08:35:04.000Z" title="更新于 2025-10-09 16:35:04">2025-10-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/%E4%B8%AD%E5%9B%BD%E6%B1%BD%E8%BD%A6%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90.html" title="中国汽车数据分析"><img src="http://cdn.diffday.com/picgo/20250926232709.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="中国汽车数据分析"/></a><div class="content"><a class="title" href="/%E4%B8%AD%E5%9B%BD%E6%B1%BD%E8%BD%A6%E6%95%B0%E6%8D%AE%E5%88%86%E6%9E%90.html" title="中国汽车数据分析">中国汽车数据分析</a><time datetime="2025-10-09T08:34:28.000Z" title="更新于 2025-10-09 16:34:28">2025-10-09</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2018 - 2025 By <a class="footer-bar-link" href="/" title="DiffDay" target="_blank">DiffDay</a></div></div><div id="footer-type-tips"></div><div class="js-pjax"><script>function subtitleType () {
  getScript('https://sdk.jinrishici.com/v2/browser/jinrishici.js').then(() => {
    jinrishici.load(result =>{
      if (false) {
        const sub = []
        const content = result.data.content
        sub.unshift(content)
        window.typed = new Typed('#footer-type-tips', {
          strings: sub,
          startDelay: 300,
          typeSpeed: 150,
          loop: true,
          backSpeed: 50,
        })
      } else {
        document.getElementById('footer-type-tips').innerHTML = result.data.content
      }
    })
  })
}

if (false) {
  if (typeof Typed === 'function') {
    subtitleType()
  } else {
    getScript('https://cdn.jsdelivr.net/npm/typed.js/dist/typed.umd.min.js').then(subtitleType)
  }
} else {
  subtitleType()
}
</script></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://github.com/anzhiyu-c/hexo-theme-anzhiyu" title="主题">主题</a><a class="footer-bar-link" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" title="粤ICP备-18103410号">粤ICP备-18103410号</a><a class="footer-bar-link cc" href="/copyright" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">178</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">51</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">8</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/archives/"><span> 归档</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/categories/"><span> 分类</span></a></div><div class="menus_item"><a class="site-page faa-parent animated-hover" href="/tags/"><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 关于</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本站</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/copyright/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 版权协议</span></a></li><li><a class="site-page child faa-parent animated-hover" href="javascript:toRandomPost()"><i class="anzhiyufont anzhiyu-icon-shoe-prints1 faa-tada" style="font-size: 0.9em;"></i><span> 随便逛逛</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/vanilla-lazyload/dist/lazyload.iife.min.js"></script><script src="https://cdn.jsdelivr.net/npm/node-snackbar/dist/snackbar.min.js"></script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.jsdelivr.net/npm/mathjax/es5/tex-mml-chtml.min.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const $mermaid = document.querySelectorAll('#article-container .mermaid-wrap')
  //if ($mermaid.length === 0) return
  const runMermaid = () => {
    window.loadMermaid = true
    const theme = document.documentElement.getAttribute('data-theme') === 'dark' ? 'dark' : 'default'

    Array.from($mermaid).forEach((item, index) => {
      const mermaidSrc = item.firstElementChild
      const mermaidThemeConfig = '%%{init:{ \'theme\':\'' + theme + '\'}}%%\n'
      const mermaidID = 'mermaid-' + index
      const mermaidDefinition = mermaidThemeConfig + mermaidSrc.textContent

      const renderFn = mermaid.render(mermaidID, mermaidDefinition)

      const renderV10 = () => {
        renderFn.then(({svg}) => {
          mermaidSrc.insertAdjacentHTML('afterend', svg)
        })
      }

      const renderV9 = svg => {
        mermaidSrc.insertAdjacentHTML('afterend', svg)
      }

      typeof renderFn === 'string' ? renderV9(renderFn) : renderV10()
    })
  }

  const loadMermaid = () => {
    window.loadMermaid ? runMermaid() : getScript('https://cdn.jsdelivr.net/npm/mermaid@11.6.0/dist/mermaid.min.js').then(runMermaid)
  }

  anzhiyu.addGlobalFn('themeChange', runMermaid, 'mermaid')

  window.pjax ? loadMermaid() : document.addEventListener('DOMContentLoaded', loadMermaid)
})()</script><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: 'uwklgzjj0IepCMXNYCU3t9Ah-9Nh9j0Va',
      appKey: 'jRMVc9QS0SBr1L9heA2V0m4q',
      avatar: 'mp',
      serverURLs: 'https://uwklgzjj.lc-cn-e1-shared.com',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.jsdelivr.net/npm/valine/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Valine' === 'Valine' || !true) {
    if (true) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script src="https://cdn.jsdelivr.net/npm/blueimp-md5/js/md5.min.js"></script><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getIcon = (icon, mail) => {
    if (icon) return icon
    let defaultIcon = '?d=mp'
    let iconUrl = `https://gravatar.loli.net/avatar/${md5(mail.toLowerCase()) + defaultIcon}`
    return iconUrl
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'></a>`
        }

        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <div class='name'><span>${array[i].nick} / </span><time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div></div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom.innerHTML= result
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const getComment = () => {
    const serverURL = 'https://uwklgzjj.lc-cn-e1-shared.com'

    var settings = {
      "method": "GET",
      "headers": {
        "X-LC-Id": 'uwklgzjj0IepCMXNYCU3t9Ah-9Nh9j0Va',
        "X-LC-Key": 'jRMVc9QS0SBr1L9heA2V0m4q',
        "Content-Type": "application/json"
      },
    }

    fetch(`${serverURL}/1.1/classes/Comment?limit=6&order=-createdAt`,settings)
      .then(response => response.json())
      .then(data => {
        const valineArray = data.results.map(function (e) {
          return {
            'avatar': getIcon(e.QQAvatar, e.mail),
            'content': changeContent(e.comment),
            'nick': e.nick,
            'url': e.url + '#' + e.objectId,
            'date': e.updatedAt,
          }
        })
        saveToLocal.set('valine-newest-comments', JSON.stringify(valineArray), 10/(60*24))
        generateHtml(valineArray)
      }).catch(e => {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      }) 
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('valine-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script>var visitorMail = "visitor@anheyu.com";
</script><script async data-pjax src="https://cdn.jsdelivr.net/npm/anzhiyu-theme-static/waterfall/waterfall.min.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/anzhiyu-theme-static/icon/ali_iconfont_css.min.css"><script src="https://cdn.jsdelivr.net/npm/pjax/pjax.min.js"></script><script>let pjaxSelectors = ["head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: true,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof chatBtnFn === 'function' && chatBtnFn()
  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', 'G-X0MW6B53JB', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.jsdelivr.net/npm/anzhiyu-theme-static/accesskey/accesskey.min.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>